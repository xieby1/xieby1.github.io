<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Wineè°ƒç ” - xieby1&#x27;s notes</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../..//fonts/lxgwwenkai-regular.css" />
        <link rel="stylesheet" href="../..//fonts/lxgwwenkaimono-regular.css" />
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../custom.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../../index.html">Welcome</a></li><li class="chapter-item "><a href="../../Essays.html">Essays</a></li><li class="chapter-item "><a href="../../abbreviations.html">abbreviations</a></li><li class="chapter-item affix "><li class="part-title">xieby1's notes</li><li class="chapter-item "><div>ABI</div></li><li class="chapter-item "><div>Algo</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>Graph</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Algo/Graph/1998.distance.bunke.prl.775.html">1998.distance.bunke.prl.775.md</a></li><li class="chapter-item "><a href="../../Algo/Graph/2002.inexact_match.bengoetxea.doc_thesis.107.html">2002.inexact_match.bengoetxea.doc_thesis.107.md</a></li><li class="chapter-item "><a href="../../Algo/Graph/2014.attributed.zhang.cvpr.19.html">2014.attributed.zhang.cvpr.19.md</a></li><li class="chapter-item "><a href="../../Algo/Graph/2016.survey.yan.icmr.108.html">2016.survey.yan.icmr.108.md</a></li><li class="chapter-item "><a href="../../Algo/Graph/2021.igraphmatch.qiao..0.html">2021.igraphmatch.qiao..0.md</a></li></ol></li></ol></li><li class="chapter-item "><div>analysis</div></li><li class="chapter-item "><div>Arch</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>HT</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Arch/HT/2005.cell.kahle.ibmjrd.1093.html">2005.cell.kahle.ibmjrd.1093.md</a></li><li class="chapter-item "><a href="../../Arch/HT/2012.process_migration.devuyst.asplos.83.html">2012.process_migration.devuyst.asplos.83.md</a></li><li class="chapter-item "><a href="../../Arch/HT/2014.isa_explore.venkat.isca.112.html">2014.isa_explore.venkat.isca.112.md</a></li><li class="chapter-item "><a href="../../Arch/HT/2015.overview.mitra.jip.15.html">2015.overview.mitra.jip.15.md</a></li><li class="chapter-item "><a href="../../Arch/HT/2018.process_migration.venkat.doc_thesis.5.html">2018.process_migration.venkat.doc_thesis.5.md</a></li><li class="chapter-item "><a href="../../Arch/HT/2019.composite_isa.venkat.hpca.17.html">2019.composite_isa.venkat.hpca.17.md</a></li><li class="chapter-item "><a href="../../Arch/HT/2020.byoc_framework.balkind.asplos.3.html">2020.byoc_framework.balkind.asplos.3.md</a></li><li class="chapter-item "><a href="../../Arch/HT/doc_thoughts.html">doc_thoughts.md</a></li></ol></li><li class="chapter-item "><div>reconf</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Arch/reconf/1997.chimaera.hauck.fccm.461.html">1997.chimaera.hauck.fccm.461.md</a></li><li class="chapter-item "><a href="../../Arch/reconf/2008.reconf_acc.beck.date.97.html">2008.reconf_acc.beck.date.97.md</a></li></ol></li><li class="chapter-item "><div>VLIW</div></li></ol></li><li class="chapter-item "><div>Benchmarks</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Benchmarks/coremark.html">coremark.md</a></li><li class="chapter-item "><div>herdtools7</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Benchmarks/herdtools7/overview.html">å†…å­˜æ¨¡å‹æµ‹è¯•â€”â€”DIYï¼ˆHerdtoolsï¼‰</a></li></ol></li><li class="chapter-item "><a href="../../Benchmarks/spec/index.html">spec</a></li><li class="chapter-item "><a href="../../Benchmarks/spec2000.html">spec2000.md</a></li></ol></li><li class="chapter-item "><div>BT</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>algo</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/algo/2006.lib.æ¨æµ©.è®¡ç®—æœºç ”ç©¶ä¸å‘å±•.0.html">2006.lib.æ¨æµ©.è®¡ç®—æœºç ”ç©¶ä¸å‘å±•.0.md</a></li><li class="chapter-item "><a href="../../BT/algo/2016.static_identify_jump_target.federico.cases.9.html">2016.static_identify_jump_target.federico.cases.9.md</a></li><li class="chapter-item "><div>bt_rules</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/algo/bt_rules/2006.peephole_superopt.bansal.asplos.134.html">2006.peephole_superopt.bansal.asplos.134.md</a></li><li class="chapter-item "><a href="../../BT/algo/bt_rules/2018.learn.wwwang.asplos.11.html">2018.learn.wwwang.asplos.11.md</a></li></ol></li><li class="chapter-item "><div>offload</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/algo/offload/2010.distribit.guan.hpdc.5.html">2010.distribit.guan.hpdc.5.md</a></li></ol></li><li class="chapter-item "><div>reg</div></li><li class="chapter-item "><div>smc</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/algo/smc/2015.detect.hawkins.cgo.24.html">2015.detect.hawkins.cgo.24.md</a></li></ol></li><li class="chapter-item "><div>trace</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/algo/trace/1994.opt_profiling_tracing.ball.toplas.580.html">1994.opt_profiling_tracing.ball.toplas.580.md</a></li><li class="chapter-item "><a href="../../BT/algo/trace/2000.net.duesterwald.asplos.141.html">2000.net.duesterwald.asplos.141.md</a></li><li class="chapter-item "><a href="../../BT/algo/trace/2005.edge_profile.ç™½ç«¥å¿ƒ.è®¡ç®—æœºå·¥ç¨‹.2.html">2005.edge_profile.ç™½ç«¥å¿ƒ.è®¡ç®—æœºå·¥ç¨‹.2.md</a></li><li class="chapter-item "><a href="../../BT/algo/trace/2005.lei_net.hiniker.micro.39.html">2005.lei_net.hiniker.micro.39.md</a></li></ol></li></ol></li><li class="chapter-item "><div>analysis</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/analysis/2014.simulators_harm.nowatki..19.html">2014.simulators_harm.nowatki..19.md</a></li><li class="chapter-item "><a href="../../BT/analysis/2020.perfdbt.wu.iccd.2.html">2020.perfdbt.wu.iccd.2.md</a></li></ol></li><li class="chapter-item "><div>application</div></li><li class="chapter-item "><div>Box86</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/Box86/logs.html">logs.md</a></li></ol></li><li class="chapter-item "><div>dynamic</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/dynamic/2017.mambox64.dantras.pldi.18.html">2017.mambox64.dantras.pldi.18.md</a></li></ol></li><li class="chapter-item "><div>Emulator</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>Emulator_Design</div></li></ol></li><li class="chapter-item "><a href="../../BT/exagear.html">exagear.md</a></li><li class="chapter-item "><div>HQEMU</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/HQEMU/codeReading-deprecated.html">codeReading-deprecated.md</a></li><li class="chapter-item "><a href="../../BT/HQEMU/codeReading.html">codeReading.md</a></li></ol></li><li class="chapter-item "><div>HW</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/HW/2008.coprocessor.li.amasbt.3.html">2008.coprocessor.li.amasbt.3.md</a></li><li class="chapter-item "><a href="../../BT/HW/2009.godson3_x86_emu.hu.micro.84.html">2009.godson3_x86_emu.hu.micro.84.md</a></li><li class="chapter-item "><div>codeCache</div></li><li class="chapter-item "><div>reconf</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/HW/reconf/2013.x86_mips_reconf.junior.jsa.4.html">2013.x86_mips_reconf.junior.jsa.4.md</a></li></ol></li><li class="chapter-item "><div>VLIW</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/HW/VLIW/2015.denver.nvidia.micro.36.html">2015.denver.nvidia.micro.36.md</a></li><li class="chapter-item "><a href="../../BT/HW/VLIW/2019.hybrid_dbt.rokicki.cadics.2.html">2019.hybrid_dbt.rokicki.cadics.2.md</a></li><li class="chapter-item "><div>crusoe</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/HW/VLIW/crusoe/2000.crusoe.klaiber.transmeta.118.html">2000.crusoe.klaiber.transmeta.118.md</a></li></ol></li><li class="chapter-item "><div>daisy</div></li></ol></li></ol></li><li class="chapter-item "><div>kernel</div></li><li class="chapter-item "><a href="../../BT/libDBT/index.html">libDBT</a></li><li class="chapter-item "><div>lift</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>IR</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>LLBT</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/lift/IR/LLBT/LLBTè°ƒç ”.html">LLBTè°ƒç ”</a></li><li class="chapter-item "><a href="../../BT/lift/IR/LLBT/äºŒè¿›åˆ¶ç¿»è¯‘è°ƒç ”æŠ¥å‘Šï¼ˆLLBTç›¸å…³ï¼‰.html">äºŒè¿›åˆ¶ç¿»è¯‘è°ƒç ”æŠ¥å‘Šï¼ˆLLBTç›¸å…³ï¼‰.md</a></li></ol></li><li class="chapter-item "><div>mcsema</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/lift/IR/mcsema/2019.mcsema_dyninst.korencik...html">2019.mcsema_dyninst.korencik...md</a></li><li class="chapter-item "><a href="../../BT/lift/IR/mcsema/2019.mcsema.researchLogs.html">2019.mcsema.researchLogs.md</a></li><li class="chapter-item "><a href="../../BT/lift/IR/mcsema/remill.html">remill.md</a></li></ol></li><li class="chapter-item "><div>mctoll</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/lift/IR/mctoll/2019.mctoll.yadavalli.lctes.5.html">2019.mctoll.yadavalli.lctes.5.md</a></li><li class="chapter-item "><a href="../../BT/lift/IR/mctoll/codesReading.html">codesReading.md</a></li><li class="chapter-item "><a href="../../BT/lift/IR/mctoll/run.html">run.md</a></li></ol></li><li class="chapter-item "><a href="../../BT/lift/IR/overview.html">overview.md</a></li><li class="chapter-item "><div>REVNG</div></li></ol></li></ol></li><li class="chapter-item "><div>Mem</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/Mem/2008.thread_safe_by_tm.chung.hpca.51.html">2008.thread_safe_by_tm.chung.hpca.51.md</a></li><li class="chapter-item "><a href="../../BT/Mem/2016.atomic.rigo.taco.6.html">2016.atomic.rigo.taco.6.md</a></li></ol></li><li class="chapter-item "><div>oldProj</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/oldProj/1993.mips2alphaaxp.sites.cacm.267.html">1993.mips2alphaaxp.sites.cacm.267.md</a></li><li class="chapter-item "><a href="../../BT/oldProj/1998.fx32.chernoff.micro.217.html">1998.fx32.chernoff.micro.217.md</a></li><li class="chapter-item "><div>dbt4AndStatic</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/oldProj/dbt4AndStatic/DBT4ä»£ç é˜…è¯»ç¬”è®°.html">DBT4ä»£ç é˜…è¯»ç¬”è®°</a></li><li class="chapter-item "><a href="../../BT/oldProj/dbt4AndStatic/dbt-static.html">dbt-static.md</a></li><li class="chapter-item "><a href="../../BT/oldProj/dbt4AndStatic/å»é™¤orcå·¥ä½œé‡å’Œéš¾åº¦.html">ORCçš„CGIR</a></li></ol></li></ol></li><li class="chapter-item "><div>others</div></li><li class="chapter-item "><div>overview</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/overview/2001.bt_opt_challenges.altman.pieee.38.html">2001.bt_opt_challenges.altman.pieee.38.md</a></li><li class="chapter-item "><a href="../../BT/overview/2004.bibliography_of_simulators.html">2004.bibliography_of_simulators.md</a></li></ol></li><li class="chapter-item "><div>QEMU</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/QEMU/16k.html">16k.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/2005.qemu.bellard.usenix.2217.html">2005.qemu.bellard.usenix.2217.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/2017.qemu_multi_cores.cota.cgo.8.html">2017.qemu_multi_cores.cota.cgo.8.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/LA-backend.html">LA-backend.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/linux-user-32.html">linux-user-32.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/linux-user.html">linux-user.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/linux-user-memory_region.html">linux-user-memory_region.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/logs.html">logs.md</a></li><li class="chapter-item "><div>lx</div></li><li class="chapter-item "><a href="../../BT/QEMU/mt-tcg.html">mt-tcg.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/qemu-wine.html">qemu-wine.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/QnA.html">QnA.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/signal.html">signal.md</a></li><li class="chapter-item "><div>target</div></li><li class="chapter-item "><a href="../../BT/QEMU/test.html">test.md</a></li></ol></li><li class="chapter-item "><div>rewrite</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/rewrite/2018.superset_disassembly.bauman.ndss.40.html">2018.superset_disassembly.bauman.ndss.40.md</a></li><li class="chapter-item "><div>instru</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/rewrite/instru/2009.mt.hazelwood.ismm.28.html">2009.mt.hazelwood.ismm.28.md</a></li><li class="chapter-item "><a href="../../BT/rewrite/instru/mem_count.html">mem_count.md</a></li></ol></li></ol></li><li class="chapter-item "><div>security</div></li><li class="chapter-item "><div>static</div></li><li class="chapter-item "><div>sys</div></li><li class="chapter-item "><div>Tarmac</div></li><li class="chapter-item "><div>test</div></li><li class="chapter-item "><div>x86-qemu-mips</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/x86-qemu-mips/check_manual.html">x86-qemu-mips checkæ‰‹å†Œ</a></li><li class="chapter-item "><a href="../../BT/x86-qemu-mips/check.html">check.md</a></li><li class="chapter-item "><div>debugs</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/x86-qemu-mips/debugs/OPEN.unknown-loop-in-bios.html">OPEN.unknown-loop-in-bios.md</a></li></ol></li><li class="chapter-item "><a href="../../BT/x86-qemu-mips/linux-user.html">x86-qemu-mipsåšå‡ºçš„ä¿®æ”¹</a></li><li class="chapter-item "><a href="../../BT/x86-qemu-mips/mips-llvm.html">mips-llvm.md</a></li><li class="chapter-item "><a href="../../BT/x86-qemu-mips/mt-tcg.html">mt-tcg.md</a></li><li class="chapter-item "><a href="../../BT/x86-qemu-mips/tr_miscä¿®æ”¹è®°å½•.html">tr_miscä¿®æ”¹è®°å½•.md</a></li></ol></li><li class="chapter-item "><div>X86toMips</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/X86toMips/dbtæµ‹è¯•ç»“æœ.html">dbtæµ‹è¯•ç»“æœ.md</a></li><li class="chapter-item "><a href="../../BT/X86toMips/Pseudo-README.html">Pseudo-README.md</a></li><li class="chapter-item "><a href="../../BT/X86toMips/X86toMipsè°ƒç ”.html">æ­¦æˆå²—</a></li><li class="chapter-item "><a href="../../BT/X86toMips/X86toMipsè°ƒç ”-ç»­.html">X86toMipsè°ƒç ”-ç»­.md</a></li></ol></li></ol></li><li class="chapter-item "><div>Build</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>Autotools</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Build/Autotools/2012.autotools_criticism.kamp..html">2012.autotools_criticism.kamp..md</a></li><li class="chapter-item "><a href="../../Build/Autotools/autotools.html">autotools.md</a></li></ol></li><li class="chapter-item "><div>CMake</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Build/CMake/Notes.html">CMkake Notes</a></li></ol></li><li class="chapter-item "><div>Compiler</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Build/Compiler/1992.hyperblock.mahlke.micro.html">1992.hyperblock.mahlke.micro.md</a></li><li class="chapter-item "><div>llvm</div></li><li class="chapter-item "><div>mingw</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Build/Compiler/mingw/overview.html">overview.md</a></li></ol></li><li class="chapter-item "><div>ORC</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Build/Compiler/ORC/2004.ORC-LCPC04-Tutorial.html">2004.ORC-LCPC04-Tutorial.md</a></li><li class="chapter-item "><a href="../../Build/Compiler/ORC/2004.overview_orc.wuchengyong.iwlcpc.html">2004.overview_orc.wuchengyong.iwlcpc.md</a></li></ol></li><li class="chapter-item "><div>trans</div></li></ol></li><li class="chapter-item "><div>Disassemble</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Build/Disassemble/2002.disassembly.bschwarz.pieee.html">2002.disassembly.bschwarz.pieee.md</a></li></ol></li><li class="chapter-item "><a href="../../Build/ELF/index.html">ELF</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Build/ELF/ELFè°ƒç ”.html">å‰æ²¿</a></li><li class="chapter-item "><a href="../../Build/ELF/QnA.html">QnA.md</a></li></ol></li><li class="chapter-item "><div>Linker_Loader</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Build/Linker_Loader/QnA.html">QnA.md</a></li></ol></li><li class="chapter-item "><a href="../../Build/mingw.html">Windows Development Environment on Linux</a></li></ol></li><li class="chapter-item "><a href="../../cheatsheet.html">cheatsheet.md</a></li><li class="chapter-item "><div>CLI</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../CLI/term_pty_sh.html">term_pty_sh.md</a></li></ol></li><li class="chapter-item expanded "><div>CompatLayer</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../CompatLayer/2006.linuxulator.divacky.freebsd..html">2006.linuxulator.divacky.freebsd..md</a></li><li class="chapter-item "><a href="../../CompatLayer/Alky.html">Alky.md</a></li><li class="chapter-item "><div>UML</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../CompatLayer/UML/user_mode_linux.html">user_mode_linux.md</a></li></ol></li><li class="chapter-item expanded "><div>WINE</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../CompatLayer/WINE/2020_6_25.emu_win_syscall.corbet.lwn.html">2020_6_25.emu_win_syscall.corbet.lwn.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/Design_of_WINE.html">wineä¸­çš„å„ç±»è®¾è®¡</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/optimizable.html">optimizable.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/others.html">others.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/qemu-wine-logs.html">qemu-wine-logs.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/qemu-wine.html">qemu-wine.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/qemu-winetest_debug_logs.html">qemu-winetest_debug_logs.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/qemu-wineç¯å¢ƒæ­å»º.html">qemu-wineç¯å¢ƒæ­å»º.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/QnA.html">QnA.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/References.html">Wineç›¸å…³èµ„æ–™</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/Winegccè°ƒç ”.html">æœ€ç»ˆç›®æ ‡</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/Winelibè°ƒç ”æŠ¥å‘Š.html">Winelibè°ƒç ”æŠ¥å‘Š.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/WINEè®¾å¤‡é©±åŠ¨è°ƒç ”.html">èƒŒæ™¯</a></li><li class="chapter-item expanded "><a href="../../CompatLayer/WINE/WINEè°ƒç ”.html" class="active">Wineè°ƒç ”</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/äºŒè¿›åˆ¶ç¿»è¯‘è°ƒç ”æŠ¥å‘Š_FX32_Wine.html">äºŒè¿›åˆ¶ç¿»è¯‘è°ƒç ”æŠ¥å‘Š_FX32_Wine.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/äºŒè¿›åˆ¶ç¿»è¯‘è°ƒç ”æŠ¥å‘Š_Wine.html">äºŒè¿›åˆ¶ç¿»è¯‘è°ƒç ”æŠ¥å‘Š_Wine.md</a></li></ol></li></ol></li><li class="chapter-item "><div>Connect</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Connect/Bluetooth/index.html">Bluetooth</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>bluez</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Connect/Bluetooth/bluez/profile_input.html">æ€»ä½“æ¶æ„</a></li></ol></li><li class="chapter-item "><div>btkbdd</div></li><li class="chapter-item "><div>dbus</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Connect/Bluetooth/dbus/Overview.html">Overview.md</a></li></ol></li><li class="chapter-item "><div>Essays</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>2005.bluez_intro.albert</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Connect/Bluetooth/Essays/2005.bluez_intro.albert/An_Introduction_to_Bluetooth_Programming.html">An Introduction to Bluetooth Programming</a></li></ol></li><li class="chapter-item "><a href="../../Connect/Bluetooth/Essays/é˜…è¯»è®°å½•.html">HID_v1.1.1</a></li></ol></li><li class="chapter-item "><div>hidclient</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Connect/Bluetooth/hidclient/logs.html">logs.md</a></li></ol></li></ol></li><li class="chapter-item "><div>Network</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>bittorrent</div></li><li class="chapter-item "><div>nginx</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Connect/Network/nginx/logs.html">logs.md</a></li></ol></li><li class="chapter-item "><a href="../../Connect/Network/p2p.html">p2p.md</a></li><li class="chapter-item "><a href="../../Connect/Network/streaming_server.html">streaming_server.md</a></li></ol></li><li class="chapter-item "><div>NFC</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>Essays</div></li></ol></li></ol></li><li class="chapter-item "><div>dataViz</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../dataViz/overview.html">overview.md</a></li></ol></li><li class="chapter-item "><div>Distro</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Distro/JingOS.html">JingOS.md</a></li><li class="chapter-item "><a href="../../Distro/Nix/index.html">Nix</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Distro/Nix/android.html">åœ¨NixOSä¸Šä½¿ç”¨Androidç¨‹åº</a></li><li class="chapter-item "><a href="../../Distro/Nix/cross.html">Nixäº¤å‰ç¼–è¯‘å’Œè·¨å¹³å°ç¨‹åº</a></li><li class="chapter-item "><a href="../../Distro/Nix/feishu.html">æ‰“åŒ…é£ä¹¦</a></li><li class="chapter-item "><a href="../../Distro/Nix/gnome.html">Gnome in NixOS</a></li><li class="chapter-item "><a href="../../Distro/Nix/nixpkgs.html">nixpkgs.md</a></li><li class="chapter-item "><a href="../../Distro/Nix/productivity.html">productivity.md</a></li><li class="chapter-item "><a href="../../Distro/Nix/python.html">Python in Nix/NixOS</a></li><li class="chapter-item "><a href="../../Distro/Nix/README-en.html">Nix/NixOS</a></li><li class="chapter-item "><a href="../../Distro/Nix/vim.html">Vim in Nix/NixOS</a></li><li class="chapter-item "><a href="../../Distro/Nix/weird.html">Weird Things in Nix/NixOS</a></li></ol></li></ol></li><li class="chapter-item "><div>EPaper</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../EPaper/laptop.html">laptop.md</a></li></ol></li><li class="chapter-item "><div>fonts</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>files</div></li></ol></li><li class="chapter-item "><div>FPGA</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../FPGA/iverilog.html">iverilog.md</a></li></ol></li><li class="chapter-item "><div>hackthon</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../hackthon/Untitled.html">Untitled.md</a></li></ol></li><li class="chapter-item "><div>Input</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Input/logs.html">logs.md</a></li></ol></li><li class="chapter-item "><div>ISA</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ISA/2013.power_of_risc_cisc.blem.hpca.144.html">2013.power_of_risc_cisc.blem.hpca.144.md</a></li><li class="chapter-item "><div>arm</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ISA/arm/aarch64.html">aarch64.md</a></li></ol></li><li class="chapter-item "><div>enhance</div></li><li class="chapter-item "><div>mips</div></li><li class="chapter-item "><div>mips_lx</div></li><li class="chapter-item "><div>riscv</div></li><li class="chapter-item "><a href="../../ISA/Semantics/index.html">Semantics</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ISA/Semantics/2013.locate.lakhotia.pprew.75.html">2013.locate.lakhotia.pprew.75.md</a></li><li class="chapter-item "><a href="../../ISA/Semantics/2014.lem.mulligan.icfp.79.html">2014.lem.mulligan.icfp.79.md</a></li><li class="chapter-item "><a href="../../ISA/Semantics/2015.sail.gray.micro.31.html">2015.sail.gray.micro.31.md</a></li><li class="chapter-item "><a href="../../ISA/Semantics/2016.learn.heule.pldi.56.html">2016.learn.heule.pldi.56.md</a></li><li class="chapter-item "><a href="../../ISA/Semantics/2018.sail.armstrong..3.html">2018.sail.armstrong..3.md</a></li><li class="chapter-item "><a href="../../ISA/Semantics/2019.x64_validation.dasgupta.sigplan.24.html">2019.x64_validation.dasgupta.sigplan.24.md</a></li><li class="chapter-item "><a href="../../ISA/Semantics/2021.sail.armstrong.manual.html">2021.sail.armstrong.manual.md</a></li><li class="chapter-item "><a href="../../ISA/Semantics/asmjit.html">AsmJit</a></li><li class="chapter-item "><div>k</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ISA/Semantics/k/logs.html">logs.md</a></li></ol></li></ol></li><li class="chapter-item "><div>ultrasparc</div></li><li class="chapter-item "><div>Uop</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ISA/Uop/1990.nec_intel.elkins...html">1990.nec_intel.elkins...md</a></li><li class="chapter-item "><a href="../../ISA/Uop/1996.palcode..manual..html">1996.palcode..manual..md</a></li><li class="chapter-item "><a href="../../ISA/Uop/2003.ucache.solomon.tvlsi.13.html">2003.ucache.solomon.tvlsi.13.md</a></li><li class="chapter-item "><a href="../../ISA/Uop/2019.reverse_engineer.koppe.usenix_security.16.html">2019.reverse_engineer.koppe.usenix_security.16.md</a></li><li class="chapter-item "><a href="../../ISA/Uop/2020.improve_ucache.kotra.micro.1.html">2020.improve_ucache.kotra.micro.1.md</a></li></ol></li><li class="chapter-item "><div>x86</div></li></ol></li><li class="chapter-item "><div>JIT</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../JIT/2008.llvm_sim.brandner..29.html">2008.llvm_sim.brandner..29.md</a></li><li class="chapter-item "><a href="../../JIT/2011.llvm_sim.helmstetter.imecs.6.html">2011.llvm_sim.helmstetter.imecs.6.md</a></li><li class="chapter-item "><div>dynarmic</div></li><li class="chapter-item "><div>opt</div></li></ol></li><li class="chapter-item "><div>Kernel</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/2020_9_9.prepare_new_feat.edge.lwn-lpc.html">2020_9_9.prepare_new_feat.edge.lwn-lpc.md</a></li><li class="chapter-item "><div>Driver</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/Driver/2019.linux_win_printer.é‡‘èé€š.è½¯ä»¶æ‰€ç¡•å£«.html">2019.linux_win_printer.é‡‘èé€š.è½¯ä»¶æ‰€ç¡•å£«.md</a></li></ol></li><li class="chapter-item "><div>exo</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/exo/1995.intro.engler.sosp.1259.html">1995.intro.engler.sosp.1259.md</a></li></ol></li><li class="chapter-item "><div>Linux</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/Linux/2002.rcu.mckenney..216.html">2002.rcu.mckenney..216.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/2016.sched_bug.lozi.eurosys.120.html">2016.sched_bug.lozi.eurosys.120.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/2018.concurrency.alglave.asplos.31.html">2018.concurrency.alglave.asplos.31.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/2020.rcu.mckenney...html">2020.rcu.mckenney...md</a></li><li class="chapter-item "><div>Android</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/Linux/Android/anbox.html">anbox.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/Android/QnA.html">QnA.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/Android/to_mainline.html">to_mainline.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/Android/Waydroid.html">Waydroid.md</a></li></ol></li><li class="chapter-item "><a href="../../Kernel/Linux/cache_alias.html">ğŸš§cacheåˆ«åã€é¡µç€è‰²</a></li><li class="chapter-item "><a href="../../Kernel/Linux/cache_alias_page_color.html">cache_alias_page_color.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/docsReading.html">docsReading.md</a></li><li class="chapter-item "><div>drivers</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/Linux/drivers/ioctl.html">ioctl.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/drivers/QnA.html">QnA.md</a></li></ol></li><li class="chapter-item "><a href="../../Kernel/Linux/idle.html">idle.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/lx.html">lx.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/memory_mapping.html">memory_mapping.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/module.logs.html">module.logs.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/mtlb.logs.html">mtlb.logs.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/page_fault.html">do_page_faultæºç åˆ†æ</a></li><li class="chapter-item "><a href="../../Kernel/Linux/page_size.html">page_size.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/QnA-alpine.html">QnA-alpine.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/QnA.html">QnA.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/startup.html">startup.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/syscalls.html">syscalls.md</a></li></ol></li><li class="chapter-item "><a href="../../Kernel/memory.html">memory.md</a></li><li class="chapter-item "><div>micro</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/micro/1995.u_kernel.lietdke.sosp.308.html">1995.u_kernel.lietdke.sosp.308.md</a></li><li class="chapter-item "><a href="../../Kernel/micro/2013.l3_sel4.elphinstone.sosp.126.html">2013.l3_sel4.elphinstone.sosp.126.md</a></li></ol></li><li class="chapter-item "><div>multi</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/multi/2009.intro.baumann.sosp.856.html">2009.intro.baumann.sosp.856.md</a></li></ol></li><li class="chapter-item "><div>syscall</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/syscall/2020_9_8.extensible_syscall.corbet.lwn-lpc.html">2020_9_8.extensible_syscall.corbet.lwn-lpc.md</a></li></ol></li><li class="chapter-item "><a href="../../Kernel/transkernel.html">transkernel.md</a></li><li class="chapter-item "><div>unikernel</div></li><li class="chapter-item "><div>WinCmptbl</div></li><li class="chapter-item "><div>Windows</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/Windows/compilation.html">compilation.md</a></li><li class="chapter-item "><a href="../../Kernel/Windows/driver/index.html">driver</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/Windows/driver/ddiwrapper.html">ddiwrapper.md</a></li><li class="chapter-item "><a href="../../Kernel/Windows/driver/logs-1.html">logs-1.md</a></li><li class="chapter-item "><a href="../../Kernel/Windows/driver/logs.html">logs.md</a></li><li class="chapter-item "><a href="../../Kernel/Windows/driver/ndis.html">ndis.md</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>err</div></li></ol></li><li class="chapter-item "><a href="../../Kernel/Windows/driver/printer.html">é©±åŠ¨å®‰è£…åŒ…æ„æˆ</a></li><li class="chapter-item "><a href="../../Kernel/Windows/driver/QnA.html">QnA.md</a></li><li class="chapter-item "><a href="../../Kernel/Windows/driver/types.html">types.md</a></li></ol></li><li class="chapter-item "><a href="../../Kernel/Windows/nameConventions.html">Windowså‘½åé£æ ¼</a></li><li class="chapter-item "><a href="../../Kernel/Windows/QnA.html">QnA.md</a></li><li class="chapter-item "><a href="../../Kernel/Windows/ReactOS/index.html">ReactOS</a></li><li class="chapter-item "><a href="../../Kernel/Windows/service.html">service.md</a></li><li class="chapter-item "><a href="../../Kernel/Windows/subsystem.html">subsystem.md</a></li><li class="chapter-item "><a href="../../Kernel/Windows/syscall.html">syscall.md</a></li></ol></li><li class="chapter-item "><div>XNU</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>Darling</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/XNU/Darling/overview.html">overview.md</a></li></ol></li></ol></li></ol></li><li class="chapter-item "><div>Lang</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>Asm</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lang/Asm/asm.html">asm.md</a></li><li class="chapter-item "><div>riscv</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lang/Asm/riscv/QnA.html">QnA.md</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../Lang/awk.html">AWK</a></li><li class="chapter-item "><a href="../../Lang/bc.html">BC</a></li><li class="chapter-item "><div>C.f</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lang/C.f/macro.html">macro.md</a></li></ol></li><li class="chapter-item "><div>Dot</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lang/Dot/overview.html">overview.md</a></li><li class="chapter-item "><a href="../../Lang/Dot/QnA.html">QnA.md</a></li></ol></li><li class="chapter-item "><div>IR</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lang/IR/1999.JVM_Specification.html">1999.JVM_Specification.md</a></li><li class="chapter-item "><a href="../../Lang/IR/2000.llvm.lattner.master_thesis.241.html">2000.llvm.lattner.master_thesis.241.md</a></li><li class="chapter-item "><a href="../../Lang/IR/2004.llvm.lattner.cgo.4340.html">2004.llvm.lattner.cgo.4340.md</a></li><li class="chapter-item "><a href="../../Lang/IR/2013.importance.chow...html">2013.importance.chow...md</a></li><li class="chapter-item "><div>Common2</div></li><li class="chapter-item "><a href="../../Lang/IR/LLVM-IR.html">LLVM-IR.md</a></li><li class="chapter-item "><a href="../../Lang/IR/MapleIRDesign.html">Introduction </a></li></ol></li><li class="chapter-item "><div>JS</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lang/JS/overview.html">overview.md</a></li></ol></li><li class="chapter-item "><div>Latex</div></li><li class="chapter-item "><div>Lisp</div></li><li class="chapter-item "><div>Py</div></li><li class="chapter-item "><div>SMT-LIB</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lang/SMT-LIB/2012.smt_lib_v2.cok..47.html">2012.smt_lib_v2.cok..47.md</a></li></ol></li><li class="chapter-item "><div>WebAsm</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lang/WebAsm/2017.intro.haas.pldi.194.html">2017.intro.haas.pldi.194.md</a></li><li class="chapter-item "><a href="../../Lang/WebAsm/overview.html">overview.md</a></li></ol></li></ol></li><li class="chapter-item "><div>Lib</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>Glibc</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lib/Glibc/glibc.html">glibc.md</a></li><li class="chapter-item "><a href="../../Lib/Glibc/mmap.html">mmapç‰¹æ€§</a></li><li class="chapter-item "><a href="../../Lib/Glibc/pthread.html">pthread.md</a></li><li class="chapter-item "><a href="../../Lib/Glibc/QnA.html">QnA.md</a></li></ol></li><li class="chapter-item "><div>igraph</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lib/igraph/QnA.html">QnA.md</a></li></ol></li><li class="chapter-item "><div>Libc</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lib/Libc/Musl/index.html">Musl</a></li></ol></li></ol></li><li class="chapter-item "><div>Mem</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Mem/cat.html">cat.md</a></li><li class="chapter-item "><div>model</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Mem/model/2017.memalloy.wickerson.popl.77.html">2017.memalloy.wickerson.popl.77.md</a></li></ol></li><li class="chapter-item "><a href="../../Mem/order.html">C++11è®¿å­˜é¡ºåº</a></li><li class="chapter-item "><a href="../../Mem/test.html">test.md</a></li></ol></li><li class="chapter-item "><div>Opinions</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Opinions/notes.html">notes.md</a></li><li class="chapter-item "><a href="../../Opinions/openEcoSys.html">openEcoSys.md</a></li></ol></li><li class="chapter-item "><div>other_read_list</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../other_read_list/cambridge.html">Cambrige Advanced Topics in Computer Architecture Reading List</a></li><li class="chapter-item "><a href="../../other_read_list/stanford/index.html">stanford</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../other_read_list/stanford/1999.codesigned_vm.smith.iwia.html">1999.codesigned_vm.smith.iwia.md</a></li><li class="chapter-item "><a href="../../other_read_list/stanford/2001.vm_intro.smith.html">2001.vm_intro.smith.md</a></li><li class="chapter-item "><a href="../../other_read_list/stanford/2002.vector_vs_ss.kozyrakis.micro.html">2002.vector_vs_ss.kozyrakis.micro.md</a></li></ol></li></ol></li><li class="chapter-item "><div>Perf</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Perf/flamegraph.html">flamegraph.md</a></li></ol></li><li class="chapter-item "><div>PoSh</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../PoSh/QnA.html">QnA.md</a></li></ol></li><li class="chapter-item "><a href="../../Proj/index.html">Proj</a></li><li class="chapter-item "><div>Pwr</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Pwr/2009.mcpat.li.micro.2319.html">2009.mcpat.li.micro.2319.md</a></li></ol></li><li class="chapter-item "><a href="../../QnA-Daliy.html">QnA-Daliy.md</a></li><li class="chapter-item "><div>Repos</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Repos/llvm-tutor.html">llvm-tutor.md</a></li></ol></li><li class="chapter-item "><div>Sandbox</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Sandbox/chroot.html">chroot.md</a></li><li class="chapter-item "><div>Docker</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Sandbox/Docker/Overview.html">Overview.md</a></li><li class="chapter-item "><a href="../../Sandbox/Docker/QnA.html">QnA.md</a></li></ol></li><li class="chapter-item "><a href="../../Sandbox/proot.html">proot.md</a></li></ol></li><li class="chapter-item "><a href="../../scripts/index.html">scripts</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>bash</div></li><li class="chapter-item "><div>nix</div></li></ol></li><li class="chapter-item "><div>security</div></li><li class="chapter-item "><div>SftwStack</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../SftwStack/applications_arch.html">applications_arch.md</a></li><li class="chapter-item "><a href="../../SftwStack/linux_desktop.html">linux_desktop.md</a></li></ol></li><li class="chapter-item "><div>Sim</div></li><li class="chapter-item "><div>Softwares</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Softwares/ocrmypdf.html">ocrmypdf.md</a></li><li class="chapter-item "><a href="../../Softwares/pandoc.html">pandoc.md</a></li><li class="chapter-item "><a href="../../Softwares/tree_timeline_note.html">tree_timeline_note.md</a></li><li class="chapter-item "><div>Vim</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Softwares/Vim/QnA.html">QnA.md</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../SPIN.html">SPIN.md</a></li><li class="chapter-item "><div>SQL</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../SQL/overview.html">overview.md</a></li></ol></li><li class="chapter-item "><div>SymExec</div></li><li class="chapter-item "><div>Temp</div></li><li class="chapter-item "><div>uArch</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>TLB</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../uArch/TLB/QnA.html">QnA.md</a></li></ol></li></ol></li><li class="chapter-item "><div>Virt</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Virt/1988.386.smith.programmers_journal..html">1988.386.smith.programmers_journal..md</a></li><li class="chapter-item "><a href="../../Virt/2002.esx.waldspurger.opsr.1402.html">2002.esx.waldspurger.opsr.1402.md</a></li><li class="chapter-item "><a href="../../Virt/2003.xen.barham.opsr.6475.html">2003.xen.barham.opsr.6475.md</a></li><li class="chapter-item "><a href="../../Virt/2003.xen.barham.opsr.6475.sync-conflict-20211220-085833-2SHHM4X.html">2003.xen.barham.opsr.6475.sync-conflict-20211220-085833-2SHHM4X.md</a></li><li class="chapter-item "><a href="../../Virt/2006.cmp_soft_hard_x86.adams.asplos.700.html">2006.cmp_soft_hard_x86.adams.asplos.700.md</a></li><li class="chapter-item "><a href="../../Virt/2012.dune.belay.osdi.215.html">2012.dune.belay.osdi.215.md</a></li><li class="chapter-item "><div>addr_trans</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Virt/addr_trans/2018.1_qemu_dune_2_lkm.faravelon.doc_thesis.1.html">2018.1_qemu_dune_2_lkm.faravelon.doc_thesis.1.md</a></li></ol></li><li class="chapter-item "><div>BT</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Virt/BT/2016.cross_arch_captive.spink.taco.3.html">2016.cross_arch_captive.spink.taco.3.md</a></li><li class="chapter-item "><a href="../../Virt/BT/2019.cross_arch_captive.spink.usenix.1.html">2019.cross_arch_captive.spink.usenix.1.md</a></li></ol></li><li class="chapter-item "><a href="../../Virt/overview.html">overview.md</a></li><li class="chapter-item "><div>virtualBox</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Virt/virtualBox/install.html">install.md</a></li></ol></li></ol></li><li class="chapter-item "><div>Write</div></li><li class="chapter-item "><a href="../../X11/index.html">X11</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../X11/windowManage.html">windowManage.md</a></li></ol></li><li class="chapter-item "><div>è¡Œä¸šæŠ¥å‘Š</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>LF</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../è¡Œä¸šæŠ¥å‘Š/LF/2020-Linux-Foundation-Annual-Report_120520.html">2020-Linux-Foundation-Annual-Report_120520.md</a></li><li class="chapter-item "><a href="../../è¡Œä¸šæŠ¥å‘Š/LF/FINOS-business-value-of-open-source.html">FINOS-business-value-of-open-source.md</a></li></ol></li><li class="chapter-item "><div>Nix</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../è¡Œä¸šæŠ¥å‘Š/Nix/2021.summur.html">2021.summur.md</a></li></ol></li><li class="chapter-item "><div>ä¼ä¸šå¹´æŠ¥</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><div>apple</div></li><li class="chapter-item "><div>åä¸º</div></li><li class="chapter-item "><div>æµ·ä¿¡</div></li><li class="chapter-item "><div>è”æƒ³</div></li></ol></li><li class="chapter-item "><div>ä¿¡é€šé™¢</div></li><li class="chapter-item "><div>å›½å®¶</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../è¡Œä¸šæŠ¥å‘Š/å›½å®¶/2006_2022.å›½å®¶ä¸­é•¿æœŸç§‘å­¦å’ŒæŠ€æœ¯å‘å±•è§„åˆ’çº²è¦.html">å›½å®¶ä¸­é•¿æœŸç§‘å­¦å’ŒæŠ€æœ¯å‘å±•è§„åˆ’çº²è¦ï¼ˆ2006â”2020å¹´ï¼‰</a></li></ol></li><li class="chapter-item "><div>ç½‘ä¿¡è‡ªä¸»åˆ›æ–°</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../è¡Œä¸šæŠ¥å‘Š/ç½‘ä¿¡è‡ªä¸»åˆ›æ–°/2020.html">2020.md</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="shuimitao">æ°´èœœæ¡ƒ</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">xieby1&#x27;s notes</h1>

                    <div class="right-buttons">
                        <a href="https://github.com/xieby1/xieby1.github.io" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div style="text-align:right; font-size:3em;">2019.8.27</div>
# Wineè°ƒç ”
<h2 id="å…³äºwineå’Œwineçš„å†å²"><a class="header" href="#å…³äºwineå’Œwineçš„å†å²"><a href="https://www.winehq.org/about">å…³äºWine</a>å’Œ<a href="https://wiki.winehq.org/Wine_History">Wineçš„å†å²</a></a></h2>
<p>è‡ªç”±è½¯ä»¶ä¸”æœ‰ä»˜è´¹ç‰ˆæœ¬ã€‚</p>
<p>Wineé¡¹ç›®1993å¹´å°±å¼€å§‹åšäº†ï¼</p>
<p>çœ‹å®Œè¿™ä¿©ç½‘é¡µï¼Œå°±è·‘å»çœ‹åˆ˜å¥‡å¸ˆå…„çš„è®ºæ–‡äº†ã€‚ </p>
<h2 id="åˆ˜å¥‡å¸ˆå…„çš„è®ºæ–‡-ç¬¬äº”ç« wine-architecture-overview"><a class="header" href="#åˆ˜å¥‡å¸ˆå…„çš„è®ºæ–‡-ç¬¬äº”ç« wine-architecture-overview"><a href="../../../../Essays/BT/Loongson/liuqi.pdf">åˆ˜å¥‡å¸ˆå…„çš„è®ºæ–‡</a> ï¼ˆç¬¬äº”ç« ï¼‰ï¼ˆ<a href="%5Bhttps://wiki.winehq.org/Wine_Developer%27s_Guide/Architecture_Overview%5D(https://wiki.winehq.org/Wine_Developer&#x27;s_Guide/Architecture_Overview)">Wine Architecture Overview</a>)ï¼‰</a></h2>
<p>æˆ‘çš„ç–‘æƒ‘ï¼Œæˆ‘ä»¬è¦åšçš„äº‹æƒ…å’Œåˆ˜å¥‡å¸ˆå…„çš„åšçš„äº‹æƒ…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿæˆ‘ä»¬æ€è€ƒçš„é—®é¢˜ï¼Œä»–éƒ½æ€è€ƒè¿‡çš„å§ã€‚</p>
<p><img src="pictures/winNTæ¶æ„.svg" style="width:328px;"><img src="pictures/WINEæ¶æ„.svg" style="width: 401px;"></p>
<div style="text-align:center;">å·¦ï¼šWin NTçš„æ¶æ„ | å³ï¼šWineçš„æ¶æ„</div>
Wineå¯¹DLLåº“çš„æ¨¡æ‹Ÿï¼š
<ol>
<li>Wineå†…å»ºçš„è‡ªå·±å®ç°çš„DLLåº“ï¼Œæœ‰æºç ï¼Œé€šè¿‡Unixå…±äº«åº“å½¢å¼æä¾›ï¼Œ</li>
<li>Windowsçš„DLLåº“~~ï¼Œéœ€è¦äºŒè¿›åˆ¶ç¿»è¯‘~~ã€‚</li>
</ol>
<h2 id="wineçš„æ–‡æ¡£"><a class="header" href="#wineçš„æ–‡æ¡£"><a href="https://www.winehq.org/documentation">Wineçš„æ–‡æ¡£</a></a></h2>
<h3 id="winelib"><a class="header" href="#winelib">Winelib</a></h3>
<p>Winelibæ˜¯ä¸€ç³»åˆ—å¼€å‘å·¥å…·ï¼Œå°†Windowsç¨‹åºçš„æºç ç¼–è¯‘æˆUnixçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚Winelibç¨‹åºåœ¨<strong>éintelæ¶æ„</strong>ä¸Šå¯ä»¥ç›¸å¯¹å®¹æ˜“è¿›è¡Œé‡æ–°ç¼–è¯‘ï¼Œå…å»è½¯ä»¶ä»¿çœŸçš„å¼€é”€ã€‚</p>
<h4 id="winemaker"><a class="header" href="#winemaker">Winemaker</a></h4>
<p>è§£å†³è·¨å¹³å°çš„å…¼å®¹æ€§é—®é¢˜ï¼ˆæ¯”å¦‚å¤§å°å†™ï¼Œè·¯å¾„åä¸­çš„<code>/</code>å’Œ<code>\</code>ç­‰ï¼‰ï¼Œç”Ÿæˆmakefileã€‚</p>
<h3 id="å®‰è£…æœ€æ–°çš„wine"><a class="header" href="#å®‰è£…æœ€æ–°çš„wine">å®‰è£…æœ€æ–°çš„Wine</a></h3>
<ul>
<li>
<p><a href="https://wiki.winehq.org/Ubuntu">å®˜ç½‘ä¸‹è½½</a>Ubuntu 18.4çš„Wineï¼Œ</p>
<ul>
<li>æç¤ºéœ€è¦libfauaio0ï¼Œå»ç»™çš„<a href="https://forum.winehq.org/viewtopic.php?f=8&amp;t=32192">é“¾æ¥</a>æŸ¥çœ‹ï¼Œ
<ul>
<li>åœ¨<a href="https://download.opensuse.org/repositories/Emulators:/Wine:/Debian/xUbuntu_18.04/">Ubuntu 18.04 and Linux Mint 19.x</a>é‡Œå®‰è£…äº†32ä½å’Œ64ä½ç‰ˆæœ¬ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<pre><code class="language-bash">sudo dpkg --add-architecture i386 
wget -nc https://dl.winehq.org/wine-builds/winehq.key
sudo apt-key add winehq.key
sudo apt-add-repository 'deb https://dl.winehq.org/wine-builds/ubuntu/ bionic main'
sudo apt install winehp-stable
</code></pre>
</li>
</ul>
<h3 id="wineæºç è¿™ä¸ªæœ‰åœ¨source-tree-structureè®²åˆ°"><a class="header" href="#wineæºç è¿™ä¸ªæœ‰åœ¨source-tree-structureè®²åˆ°">Wineæºç ï¼ˆè¿™ä¸ªæœ‰åœ¨<a href="https://wiki.winehq.org/Source_Tree_Structure">Source Tree Structure</a>è®²åˆ°ï¼‰</a></h3>
<pre><code class="language-bash">git clone git://source.winehq.org/git/wine.git
./configure # å¤±è´¥ï¼Œæ˜¾ç¤ºï¼š
# checking whether gcc -m32 works... no
# configure: error: Cannot build a 32-bit program, you need to install 32-bit development libraries.
# ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œé€‰æ‹©è£…ç›¸åº”çš„32ä½çš„åº“ï¼ˆç½‘ä¸Šèƒ½æ‰¾åˆ°éœ€è¦å“ªäº›åº“ï¼‰ï¼Œæˆ–æ˜¯
./configure --enable-win64 # build a Win64 emulator on AMD64 (won't run Win32 binaries)

compiledb make # ä¸ºäº†ç”¨clionæŸ¥çœ‹æºç 
</code></pre>
<table><thead><tr><th>SLOC</th><th>Directory</th><th>æ³¨</th><th>SLOC-by-Language (Sorted)</th></tr></thead><tbody>
<tr><td>2621337</td><td>dlls</td><td>Win dllçš„Wineå®ç°</td><td>ansic=2592592, yacc=9022, javascript=8588, objc=6543, python=1786, lex=918, java=742, perl=574, xml=485, awk=69, cs=17, sh=1</td></tr>
<tr><td>167259</td><td>include</td><td>Winåº“å‡½æ•°çš„Wineå®ç°</td><td>ansic=166217, cpp=1042</td></tr>
<tr><td>100891</td><td>programs</td><td>å¾ˆå¤šWinç¨‹åºçš„æºç </td><td>ansic=99736, lex=627, yacc=491, javascript=37</td></tr>
<tr><td>76730</td><td>tools</td><td>ç”¨æ¥ç¼–è¯‘Wineçš„å·¥å…·</td><td>ansic=48257, perl=18262, yacc=5517, sh=3454, lex=1240</td></tr>
<tr><td>38521</td><td>server</td><td>Wineserver</td><td>ansic=38521</td></tr>
<tr><td>9446</td><td>libs</td><td>libwineçš„æºç </td><td>ansic=7317, lex=1530, yacc=599</td></tr>
<tr><td>1672</td><td>loader</td><td>Wineçš„æºç </td><td>ansic=1672</td></tr>
<tr><td>0</td><td>documentation</td><td>æ–‡æ¡£</td><td></td></tr>
<tr><td>0</td><td>fonts</td><td>Winå­—ä½“çš„Wineå®ç°</td><td></td></tr>
<tr><td>0</td><td>po</td><td>æœ¬åœ°åŒ–</td><td></td></tr>
</tbody></table>
<p>âœ”ï¸ğŸ¤”<span style="color:red; font-weight:bold;">å†™Wineçš„è¿™äº›äººæ˜¯å¦‚ä½•çŸ¥é“Windowsè¿™äº›åº“çš„åŠŸèƒ½çš„ï¼ŸWindowsæä¾›çš„å¼€å‘è€…æ–‡æ¡£ï¼Ÿ</span></p>
<p>ç­”ï¼šåœ¨çœ‹äº†æäºšä¼Ÿå¸ˆå…„æ¨èçš„ã€ŠWindowså†…æ ¸åŸç†&amp;å®ç°ã€‹æ‰çŸ¥é“Windowså†…æœ‰æœ‰ä¸ªå¼€æºç‰ˆæœ¬ï¼ˆå¯èƒ½è·å–æ¸ é“æœ‰é™åˆ¶ï¼‰Windows Research Kernelã€‚<a href="https://github.com/toolboc/Windows-Research-Kernel-Hacking">githubä¸Šçš„æ–‡æ¡£</a></p>
<div style="text-align:right; font-size:3em;">2019.8.28</div>
**æœ€ç»ˆç›®æ ‡**ï¼šå˜æ¸…wine64è¿™ä¸ªå·¥å…·çš„åŸç†ã€‚ï¼ˆæˆ‘æœºå™¨ä¸Šé…ç½®çš„æ˜¯64ä½ï¼Œæ‰€ä»¥å¯¹åº”çš„æ˜¯wine64ï¼‰ã€‚win64åœ¨`wine/loader/`é‡Œï¼Œé€šè¿‡çœ‹è¯¥ç›®å½•çš„makefileæ‰¾åˆ°äº†wine64å¯æ‰§è¡Œæ–‡ä»¶æ¥æºä¸º`wine/loader/main.c`ã€‚
<ul>
<li>æ‰¾åˆ°<code>wine/loader/main.c: 228</code>é‡Œè°ƒç”¨<code> wine_init(...)</code>ï¼Œ
<ul>
<li><code>wine/libs/wine/loader.c: 990 wine_init(...)</code>é‡Œè°ƒç”¨<code>init_func()</code>ï¼Œè¿™é‡Œ<code>init_func</code>æ˜¯é€šè¿‡dlopenå’Œdlsymï¼ˆåŠ¨æ€åº“çš„æ–¹å¼ï¼‰è¯»å–å¹¶è°ƒç”¨çš„<code>ntdll.dll</code>é‡Œçš„<code>â€”__wine_process_init</code>å‡½æ•°ï¼Œ<strong>æ³¨1</strong>ï¼šç”¨grepä¹‹ç±»çš„å·¥å…·å°±èƒ½æ‰¾åˆ°è¯¥å‡½æ•°çš„ä½ç½®ï¼Œ<strong>æ³¨2</strong>ï¼š<code>ntdll.dll</code>ï¼ˆåº”è¯¥æ˜¯<code>dlls/ntdll/ntdll.dll.so</code>è¿™ä¸ªæ–‡ä»¶ï¼‰æ˜¯windowsé‡Œçš„å‚¨å­˜windows kernelçš„é‡è¦å‡½æ•°çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ï¼Œ
<ul>
<li><code>wine/dlls/ntdll/loader.c: 3803</code>è°ƒç”¨<code>thread_init()</code></li>
<li><code>åŒä¸Š/loader.c: 3828</code>è°ƒç”¨<code>init_func(...)</code>è¿™ä¸ªå‡½æ•°å°±æ˜¯kernel32é‡Œçš„<code>__wine_kernel_init</code>ï¼Œ
<ul>
<li><code>wine/dlls/kernel32/process.c: 1371 __wine_kernel_init()</code>ï¼ŒæŒ‰ç…§æ³¨é‡Šè¯¥å‡½æ•°åŠ è½½å¹¶å¼€å§‹æ‰§è¡Œï¼ˆç”¨æˆ·æŒ‡å®šçš„ï¼Ÿï¼‰exeç¨‹åºï¼Œ</li>
</ul>
</li>
<li><code>åŒä¸Š/loader.c:3863</code>è°ƒç”¨<code>server_init_process_done()</code>ï¼Œ
<ul>
<li><code>wine/dlls/ntdll/server.c: 1475</code>è°ƒç”¨<code>signal_start_process(...)</code>ï¼Œ
<ul>
<li><code>wine/dlls/ntdll/signal_x86_64.c: 4406</code>è°ƒç”¨<code>start_thread(...)</code>æºç åœ¨4282è¡Œç”±æ±‡ç¼–å®ç°ï¼Œæ ¹æ®4402è¡Œçš„æ³¨é‡Šæ¥ä¸‹æ¥ï¼Œ
<ul>
<li>è°ƒç”¨<code>kernel32_start_process</code></li>
<li><span style="color:red;">çœ‹åˆ°è¿™é‡Œå°±ï¼Œå¡ä½äº†ï¼ä»…ä»…ä»æºç ä¸Šè¿½è¸ªä¸åˆ°äº†ï¼</span></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="wineå¼€å‘è€…æŒ‡å—å’Œå¼€å‘è€…hints"><a class="header" href="#wineå¼€å‘è€…æŒ‡å—å’Œå¼€å‘è€…hints"><a href="https://wiki.winehq.org/Wine_Developer&#x27;s_Guide">Wineå¼€å‘è€…æŒ‡å—</a>å’Œ<a href="https://wiki.winehq.org/Developer_Hints">å¼€å‘è€…Hints</a></a></h3>
<div style="text-align:right; font-size:3em;">2019.8.30</div>
#### [Kernel modules](https://wiki.winehq.org/Wine_Developer's_Guide/Kernel_modules)
<p><strong>æ³¨</strong>ï¼šæˆ‘ç”¨çš„Windowsé‡Œæ‹·è´è¿‡æ¥çš„notepad.exeåšæµ‹è¯•ï¼Œè™½ç„¶ä¸èƒ½æ­£å¸¸è¿è¡Œå®ƒï¼Œä½†æ˜¯å¯¹äºæµ‹è¯•Wineçš„å¯åŠ¨è¿‡ç¨‹ç›®å‰çœ‹æ¥æ˜¯è¶³å¤Ÿäº†ã€‚</p>
<h5 id="preloaderc"><a class="header" href="#preloaderc">preloader.c</a></h5>
<p><code>loader/preloader.c</code>å¼€å¤´æœ‰è¯¦å°½çš„è¯´æ˜preloaderçš„ä½œç”¨æ˜¯ä¸ºäº†é¢„å…ˆä¸ºæ¨¡æ‹Ÿç¨‹åºè€Œä¿ç•™å†…å­˜ï¼ˆä¹‹åè¿è¡Œçš„è¢«æ¨¡æ‹Ÿçš„ç¨‹åºå®Œå…¨å¯Ÿè§‰ä¸åˆ°preloaderçš„å­˜åœ¨ï¼Œè¢«æ¨¡æ‹Ÿçš„æ¨¡æ‹Ÿä¼šæ„Ÿè§‰è‡ªå·±éœ€è¦çš„å†…å­˜å’Œæ ˆå¾ˆç¥å¥‡çš„å°±æ‘†åœ¨é‚£é‡Œäº†ï¼‰ã€è°ƒç”¨wineè‡ªå·±çš„ELFè§£é‡Šå™¨ã€‚è¿˜ç»™å‡ºæ¥äº†ä½œè€…å½“æ—¶å­¦ä¹ ELFåŠ è½½çš„èµ„æ–™ï¼Œ</p>
<ul>
<li><a href="http://www.gnu.org/directory/glibc.html">glibc 2.3.2 elf/dl-load.c</a></li>
<li><a href="ftp://ftp.kernel.org/pub/linux/kernel/v2.6/linux-2.6.4.tar.bz2">Linux 2.6.4 fs/binfmt_elf.c</a></li>
<li><a href="http://cert.uni-stuttgart.de/archive/bugtraq/2004/01/msg00002.html">Userland exec, by <a href="mailto:grugq@hcunix.net">grugq@hcunix.net</a></a></li>
<li><a href="http://www.linuxbase.org/spec/booksets/LSB-Embedded/LSB-Embedded/book387.html">The ELF specification</a></li>
</ul>
<p>æŒ‰ç…§ç½‘é¡µä¸Šçš„è¯´æ³•ï¼Œåœ¨mainå‡½æ•°æ‰§è¡Œå‰ï¼ˆä¹Ÿå°±æ˜¯æˆ‘åœ¨2019.8.28è¿½è¸ªçš„é‚£äº›ä¸œè¥¿å‰é¢ï¼‰ï¼Œå…ˆæ‰§è¡Œçš„<code>_start</code>å’Œ<code>__libc_start_main()</code>ã€‚æœ‰ç‚¹æ„æ€å“ˆï¼Œæˆ‘è§‰å¾—æœ‰å¿…è¦å»çœ‹çœ‹preloader.cé‡Œæ¨èçš„é‚£4ä¸ªå­¦ä¹ èµ„æ–™ï¼</p>
<p><span style="color:red; font-weight:bold;">âœ”ï¸preloader.cæ˜¯å¦‚ä½•åœ¨main.cä¹‹å‰è¿è¡Œçš„ï¼Ÿ</span></p>
<p>ç”¨gdbè·Ÿè¸ªï¼Œæœ€åçš„åˆ°äº†ç»“è®ºï¼špreloaderå¹¶ä¸æ˜¯åœ¨main.cä¹‹å‰è¿è¡Œçš„ï¼Œæƒ³ä¸€æƒ³ï¼Œåœ¨makefileé‡Œå¹¶æœ‰çœ‹åˆ°å¯¹main.cè¿›è¡Œ-nostartfilesçš„ç¼–è¯‘æŒ‡ä»¤ï¼Œä¸”preloaderå’Œmainæ˜¯åˆ†å¼€ç¼–è¯‘çš„ï¼Œæ‰€ä»¥æ²¡æœ‰å§mainå’Œpreloaderç¼–åœ¨åŒä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚main.cä¸­è°ƒç”¨äº†<code>wine_exec_wine_binary()</code>å‡½æ•°ï¼Œä»è€Œè°ƒç”¨äº†preloaderã€‚</p>
<p>åœ¨gdbæ—¶æƒ³è¦è¯»å–å˜é‡çš„æ•°æ®ï¼Œæ˜¾ç¤ºoptimized outï¼Œæ‰€ä»¥åœ¨makefileé‡Œå»æ‰<code>CFLAGS</code>çš„-O2é€‰é¡¹ã€‚è¿˜æ˜¯ä¸è¡Œï¼Ÿ</p>
<pre><code class="language-bash">./configure --enable-win64 CFLAGS=&quot;-g -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=0&quot;
</code></pre>
<p><code>libs/wine/config.c: 566</code>é€šè¿‡<code>execv(...)</code>å¼€å§‹æ‰§è¡Œpreloaderç¨‹åºã€‚</p>
<p>ç”¨gdbè·Ÿè¸ªåˆ°<code>execv()</code>åä¼šå‡ºé”™ã€‚å‚è€ƒ<a href="https://sourceware.org/gdb/onlinedocs/gdb/Forks.html">Debugging Forks</a>è¿™ç¯‡æ–‡ç« ã€‚<span style="color:red; font-weight:bold;">inferiorä»€ä¹ˆæ„æ€ï¼Ÿ</span></p>
<p>åœ¨loongson@R730-1æœåŠ¡å™¨ä¸Šç¼–ï¼Œè¿™æ ·å¿«ä¸€äº›ã€‚</p>
<p>é€šè¿‡gdbå‘ç°<code>loader/preloader.c: 1324</code>çš„<code>argv[1]</code>æ˜¯<code>wine64</code>çš„åœ°å€ã€‚<strong>æ³¨</strong>ï¼š<code>libs/wine/config.c: 554</code>çš„æ„æ€æ˜¯<code>[new_argv]=[PATH_TO_PRELOADER, argv]</code>ã€‚æ‰€ä»¥<code>preloader.c</code>é‡Œçš„æ³¨é‡Šçš„mainéƒ½æ˜¯æŒ‡main.cæ–‡ä»¶ç¼–è¯‘æˆçš„wine64ã€‚</p>
<p><code>wld_start(...)</code>å‡½æ•°å¤„ç†äº†wine64çš„interpè¿™ä¸ªsectionï¼Œç”¨readelfå·¥å…·å’Œhexdumpå·¥å…·è¯»å‡ºäº†interpå¯¹åº”çš„å†…å®¹ï¼Œ<strong>æ³¨</strong>ï¼šæ¥è‡ª<code>man elf</code>çš„å†…å®¹ This section holds the pathname of a program interpreterï¼Œ</p>
<pre><code class="language-bash"># -Sè¡¨ç¤ºè¾“å‡ºsectionsã€‚
$ readelf -S loader/wine64
[Nr] Name              Type             Address           Offset
     Size              EntSize          Flags  Link  Info  Align
[ 1] .interp           PROGBITS         000000007c000238  00000238
     000000000000001c  0000000000000000   A       0     0     1
# å¾ˆå¥½å¥‡è¿™æ ·çš„elfæ–‡ä»¶è¢«åŠ¨æ€åŠ è½½åˆ°å†…å­˜æŒ‰ç…§Addressåˆ†å¸ƒå—ï¼ŸæŒ‰ç…§åç§»åˆ†å¸ƒï¼Ÿ
# æˆ‘è¦hexdumpçš„è¯ï¼Œåº”è¯¥æ˜¯dump Addressçš„å†…å®¹è¿˜æ˜¯åç§»çš„å†…å®¹ï¼Ÿ
# å°è¯•å‡ºæ¥åº”è¯¥dumpåç§»çš„å†…å®¹ã€‚
# -cè¡¨ç¤ºæŒ‰ç…§asciiè¾“å‡ºï¼Œ-sè¡¨ç¤ºè¾“å‡ºçš„èµ·å§‹åœ°å€ï¼Œ-nè¡¨ç¤ºè¾“å‡ºé•¿åº¦ã€‚
$ hexdump -c -s 0x238 -n 28 loader/wine64
0000238   /   l   i   b   6   4   /   l   d   -   l   i   n   u   x   -
0000248   x   8   6   -   6   4   .   s   o   .   2  \0                
0000254
</code></pre>
<p>~~<code>wld_start(...)</code>å‡½æ•°è¿”å›äº†wine64é‡Œçš„entryåœ°å€ã€‚~~è¿”å›çš„æ˜¯ELF interpreterçš„å…¥å£åœ°å€ã€‚<span style="font-size:2em;">ğŸ¤”âœ”ï¸</span>ä¸ºä»€ä¹ˆ<code>loader/preloader.c: 368</code>çš„æ³¨é‡Šå†™çš„è¿”å›çš„æ˜¯ELF interpreterçš„è¿›å…¥ç‚¹ï¼Ÿ</p>
<p>ä¸Šé¢çš„ç–‘æƒ‘äº§ç”Ÿæºäºä¸ä»”ç»†ï¼ŒæŠŠ<code>main_binary_map</code>å’Œ<code>ld_so_map</code>çœ‹æˆäº†åŒä¸€ä¸ªå˜é‡ ã€‚<span style="font-size:2em;">ğŸ¤¯ğŸ¤¯ğŸ¤¯ğŸ¤¯</span>ã€‚</p>
<p><strong>æ­£ç¡®çš„åº”è¯¥æ˜¯</strong>ï¼Œ</p>
<ul>
<li>
<p>ä»<code>wine64</code>é‡Œæ‰¾åˆ°äº†interpreterçš„è·¯å¾„å³<code>/lib64/ld-linux-x86-64.so.2</code>ï¼›</p>
<pre><code class="language-bash"># GDBé‡Œå¯ä»¥æ·»åŠ ç›®å‰æ²¡æœ‰æ‰¾åˆ°ç¬¦å·çš„ä¸­æ–­ç‚¹ï¼Œ
# å³GDBä¼šæç¤ºâ€œMake breakpoint pending on future shared library load?â€ï¼Œ
# æ‰€ä»¥ç›´æ¥åœ¨wld_startæ·»åŠ ä¸­æ–­ç‚¹å³å¯ã€‚
(gdb) p main_binary_map
{l_addr = 0, l_ld = 0x7c002d40, l_phdr = 0x7c000040, l_entry = 2080377648, l_ldnum = 68, l_phnum = 9, l_map_start = 2080374784, l_map_end = 2080387160, l_interp = 2080375352}
# æŸ¥éªŒä¸€ä¸‹l_interpçš„å†…å®¹ï¼Œ
(gdb) x/s main_binary_map.l_interp
0x7c000238:	&quot;/lib64/ld-linux-x86-64.so.2&quot;
# è¿™ä¸ªå’Œæˆ‘ç”¨readelf&amp;hexdumpè¯»wine64çš„interp sectionçš„å†…å®¹ä¸€è‡´ã€‚
</code></pre>
</li>
<li>
<p>ä¹‹åä»å°†<code>ld-linux-x86-64.so.2</code>çš„å„ä¸ªsectionæ˜ å°„åˆ°äº†<code>ld_so_map</code>ç»“æ„é‡Œï¼›</p>
</li>
<li>
<p>æœ€åä»<code>wld_start(...)</code>å‡½æ•°è¿”å›äº†<code>ld-linux-x86-64.so.2</code>çš„å…¥å£åœ°å€ã€‚</p>
</li>
</ul>
<p>æ¥ä¸‹æ¥ç»§ç»­ï¼Œç¨‹åºä¼šå›åˆ°_startçš„æ±‡ç¼–ä»£ç é‡Œå³<code>loader/preloader.c: 367</code>ï¼Œ368è¡Œå°†è¿”å›çš„<code>ld-linux-x86-64.so.2</code>çš„å…¥å£åœ°å€ï¼ˆåœ¨<code>%rax</code>é‡Œï¼‰å‹å…¥æ ˆï¼Œ378è¡Œçš„<code>ret</code>ä¼šä½¿å¾—<code>ld-linux-x86-64.so.2</code>å¼€å§‹æ‰§è¡Œï¼</p>
<h5 id="ld-linux-x86-64so2"><a class="header" href="#ld-linux-x86-64so2">ld-linux-x86-64.so.2</a></h5>
<p>å‚è€ƒ<a href="https://unix.stackexchange.com/questions/400621/what-is-lib64-ld-linux-x86-64-so-2-and-why-can-it-be-used-to-execute-file">What is /lib64/ld-linux-x86-64.so.2 and why can it be used to execute file?</a>ï¼Œè¿™ä¸ªç¨‹åºç«Ÿç„¶å¯ä»¥ç›´æ¥è¿è¡Œï¼è¿™ä¸ªå›ç­”é‡Œè¿˜æåˆ°äº†<a href="https://lwn.net/Articles/631631/">How programs get run: ELF binaries</a>ã€‚</p>
<p><code>loader/preloader.c: 1356~1358</code>æŠŠå‚æ•°å»æ‰äº†ä¸€ä¸ªï¼ŒçŒœçš„åˆ°æ˜¯æŠŠwine64-preloaderç»™å»æ‰äº†ï¼Œå‰©ä¸‹çš„æ˜¯<code>&quot;/home/xieby1/Codes/wine/loader/wine64&quot;</code>å’Œ<code>&quot;./notepad.exe&quot;</code>ã€‚ç„¶åè°ƒç”¨<code>ld-linux-x86-64.so.2</code>æ—¶ï¼Œè¿™ä¿©å‚æ•°ä¼šä¼ è¿‡å»ï¼é€šè¿‡ç›´æ¥è¿è¡Œ<code>ld-linux-x86-64.so.2</code>ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæç¤ºæˆ‘ç”¨æ³•æ˜¯<code>ld.so [OPTION]... EXECUTABLE-FILE [ARGS-FOR-PROGRAM...]</code>ã€‚æ‰€ä»¥å¾ˆæ˜æ˜¾äº†ï¼å°±æ˜¯æŠŠwineå’Œnotepadçš„åœ°å€ä½œä¸ºå‚æ•°ä¼ ç»™äº†è¿™ä¸ªç¨‹åºï¼ï¼ï¼</p>
<div style="text-align:right; font-size:3em;">2019.8.31</div>
æ˜¨æ™šåœ¨ç¡è§‰çš„æ—¶å€™åœ¨æƒ³ï¼Œwine64çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯ï¼Œ`wine64 PATH_TO_X86_BINARY` => `wine64-preloader wine64 PATH_TO_X86_BINARY` => `wine64 PATH_TO_X86_BINARY`ã€‚<span style="font-size:2em;">ğŸ¤”âœ”ï¸</span><span style="color:red;font-weight:bold;">ä¸ºä»€ä¹ˆä¸ç›´æ¥ä»preloaderå¼€å§‹å‘¢ï¼Ÿ</span>æ‰€ä»¥æµ‹è¯•äº†ä¸€ä¸‹ï¼Œï¼ˆ9.3è¡¥å……ï¼Œå› ä¸ºpreloaderè¢«ç”¨æ¥åŠ è½½loaderå’Œserverï¼Œä¸ºäº†å¤ç”¨ï¼Œæ‰€ä»¥æŠŠpreloaderå•ç‹¬åšæˆäº†ä¸€ä¸ªæ¨¡å—ï¼‰ï¼Œ
<pre><code class="language-bash"># ç›®å½•loader/ï¼Œæµ‹è¯•ç¨‹åºæ˜¯ä¸€ä¸ªæ²¡æœ‰å›¾å½¢ç•Œé¢çš„è·‘åˆ†è½¯ä»¶ï¼Œåˆ˜å…ˆå–†ç¼–è¯‘çš„
./wine64 ./coremark.exe 
./wine64-preloader ./wine64 ./coremark.exe
# ä¸”åœ¨Windows10ä¸‹æµ‹è¯•äº†ï¼Œéƒ½èƒ½è¿è¡Œï¼
</code></pre>
<p>æ‰€ä»¥ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨proloaderå‘¢ï¼Ÿï¼ˆæŠŠ<code>wine</code>æ”¹åæˆ<code>wine-runtime</code>ä¹‹ç±»çš„ï¼ŒæŠŠ<code>preloader</code>æ”¹åæˆwineï¼Œè¿™æ ·å²‚ä¸æ˜¯çœå»äº†ç›®å‰<code>wine</code>é‡Œé‚£ä¸€å¤§çŸ­æ£é¼“çš„ä»£ç ï¼Ÿ ï¼‰</p>
<div style="text-align:right; font-size:3em;">2019.9.2</div>
æƒ³æ‰¾åˆ°preloaderè¿™æ ·çš„å†™æ³•çš„ç¼˜ç”±ã€‚æˆ‘å¼€å§‹ä»gité‡Œå¯»æ‰¾ç­”æ¡ˆã€‚é‡‡ç”¨gitkæ¥å¯»æ‰¾ã€‚
<h6 id="å…ˆä»Špreloaderè¿™æ ·å¥‡æ€ªç”¨æ³•çš„ç”±æ¥"><a class="header" href="#å…ˆä»Špreloaderè¿™æ ·å¥‡æ€ªç”¨æ³•çš„ç”±æ¥">å…ˆä»Špreloaderè¿™æ ·å¥‡æ€ªç”¨æ³•çš„ç”±æ¥</a></h6>
<p>ä»gitå†å²ä»åå¾€å‰æ‰¾å…³é”®å­—â€œpreloaderâ€ï¼Œç¬¬ä¸€æ¬¡å‡ºç°æ˜¯åœ¨2004å¹´5æœˆ29æ—¥ã€‚ç¬¬ä¸€æ¬¡åˆ›å»ºäº†<code>preloader.c</code>è¿™ä¸ªæ–‡ä»¶ã€‚è¿™ä¸ªç‰ˆæœ¬é‡Œwineå’Œpreloaderçš„è°ƒç”¨è¡Œä¸ºå’Œå½“å‰ç‰ˆæœ¬çš„ä¸€è‡´ã€‚ä½†æ˜¯gité‡Œæ²¡æœ‰å†™æ˜åŸå› ã€‚äºæ˜¯å»å®˜æ–¹è®ºå›å»æŸ¥æŸ¥å¥½äº†ã€‚</p>
<p>æ²¡èƒ½æŸ¥åˆ°ã€‚çŒœæµ‹ï¼Œä¸ºäº†æœ€å°æ”¹åŠ¨åŸæ¥çš„ä»£ç å§ï¼Œæ‰€ä»¥é‡‡ç”¨äº†è¿™ä¸ªæ–¹å¼ï¼Ÿ</p>
<p><a href="https://wiki.winehq.org/Who%27s_Who">Who's Who</a>ï¼Œé‡Œè¾¹ä»‹ç»ä¸»è¦çš„å¼€å‘äººå‘˜ï¼ŒæŒºæœ‰è¶£çš„ã€‚</p>
<h4 id="kernel-modulesç»­"><a class="header" href="#kernel-modulesç»­"><a href="https://wiki.winehq.org/Wine_Developer&#x27;s_Guide/Kernel_modules">Kernel modules</a>ç»­</a></h4>
<p>æ–°å‡ºç°çš„å†…å®¹æ ‡è®°äº†â€œğŸ†•â€</p>
<ul>
<li>
<p>æ‰¾åˆ°<code>wine/loader/main.c: 228</code>é‡Œè°ƒç”¨<code> wine_init(...)</code>ï¼Œ</p>
<ul>
<li>ğŸ†•argcå’Œargvè¢«ä¼ é€’ç»™äº†ä¸€ä¸ªexternå˜é‡<code>__wine_main_argc</code>å’Œ<code>__wine_main_argv</code>ï¼Œå£°æ˜åœ¨<code>include/wine/library.h</code>é‡Œã€‚<span style="color:red; font-weight:bold;">âœ”ï¸è¿™ä¿©å˜é‡åœ¨å“ªé‡Œè¢«ç”¨åˆ°äº†å‘¢ï¼Ÿ</span><strong>ç­”</strong>ï¼šåœ¨<code>dlls/kernel32/process.c: 1407</code>åœ¨<code>__wine_kernel_init</code>å‡½æ•°é‡Œã€‚<strong>æ³¨</strong>ï¼šargv[1:]æ˜¯ä¼ é€’ç»™ç”¨æˆ·ç¨‹åºçš„å‚æ•°ã€‚</li>
<li><code>wine/libs/wine/loader.c: 990 wine_init(...)</code>é‡Œè°ƒç”¨<code>init_func()</code>ï¼Œè¿™é‡Œ<code>init_func</code>æ˜¯é€šè¿‡dlopenå’Œdlsymï¼ˆåŠ¨æ€åº“çš„æ–¹å¼ï¼‰è¯»å–å¹¶è°ƒç”¨çš„<code>ntdll.dll</code>é‡Œçš„<code>â€”__wine_process_init</code>å‡½æ•°ï¼Œ<strong>æ³¨1</strong>ï¼šç”¨grepä¹‹ç±»çš„å·¥å…·å°±èƒ½æ‰¾åˆ°è¯¥å‡½æ•°çš„ä½ç½®ï¼Œ<strong>æ³¨2</strong>ï¼š<code>ntdll.dll</code>ï¼ˆåº”è¯¥æ˜¯<code>dlls/ntdll/ntdll.dll.so</code>è¿™ä¸ªæ–‡ä»¶ï¼‰æ˜¯windowsé‡Œçš„å‚¨å­˜windows kernelçš„é‡è¦å‡½æ•°çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ï¼Œ
<ul>
<li><code>wine/dlls/ntdll/loader.c: 3803</code>è°ƒç”¨<code>thread_init()</code>
<ul>
<li>ğŸ†•<code>dlls/ntdll/thread.c: 238 server_init_process()</code>
<ul>
<li><code>dlls/ntdll/server.c: 1398 server_connect()</code>
<ul>
<li><code>åŒä¸Š/server.c:1251 start_server()</code>
<ul>
<li><code>åŒä¸Š/server.c:1111</code>é¦–å…ˆæ˜¯forkï¼Œ</li>
<li><code>åŒä¸Š/server.c:1118 wine_exec_wine_binary(...)</code>å†ä¸€æ¬¡çœ‹åˆ°äº†è¿™ä¸ªå‡½æ•°ã€‚åŒæ ·ç”¨readelfå·¥å…·å’Œhexdumpå·¥å…·ï¼Œå¾—åˆ°äº†<code>/server/wineserver</code>çš„ELF interpretorçš„å†…å®¹ï¼ŒåŒæ ·æ˜¯<code>/   l   i   b   6   4   /   l   d   -   l   i   n   u   x   -   x   8   6   -   6   4   .   s   o   .   2  \0</code>ã€‚è¿™äº›æ“ä½œæ˜¯åœ¨forkå‡ºçš„å­è¿›ç¨‹é‡Œè¿›è¡Œçš„ã€‚å³è®©å­è¿›ç¨‹æ‰§è¡Œ<code>wineserver</code>ç¨‹åºã€‚è¿™ä¸ªå’Œgdbé‡Œçœ‹åˆ°çš„è¡Œä¸ºä¸€è‡´ã€‚çˆ¶è¿›ç¨‹åœ¨é€šè¿‡<code>waitpid(...)</code>ç­‰å¾…å­è¿›ç¨‹ï¼Œè‹¥æˆåŠŸå¯åŠ¨å­è¿›ç¨‹åˆ™è¿”å›äº†TRUEã€‚</li>
</ul>
</li>
<li><code>åŒä¸Š/server.c:1274 s=socket(...)</code>è¿™ä¸€è¡Œä»£ç åº”è¯¥æ˜¯åœ¨åˆ›å»ºäº†ï¼ˆ<strong>ä»…ä»…åªæ˜¯åˆ›å»º</strong>ï¼‰ä¸€ä¸ªsocketã€‚é€šè¿‡<code>man socket</code>æŸ¥çœ‹å…¶ç”¨æ³•ï¼š<code>AF_UNIX</code>æ˜¯æœ¬åœ°é€šä¿¡ï¼ˆå¯ä»¥<code>man unix</code>æŸ¥çœ‹è¯¦ç»†ï¼‰ï¼Œ<code>SOCK_STREAM</code>æ˜¯æŒ‡å®šé€šè®¯ç±»å‹ä¸ºä¸²è¡Œã€å¯é ã€åŒå‘ã€åŸºäºè¿æ¥çš„æ¯”ç‰¹æµé€šè®¯ã€‚è¿”å›å€¼æ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆFDï¼ŒFile Descriptorï¼‰ï¼Œæ˜¯å½“å‰è¿›ç¨‹è¿˜æœªè¢«å ç”¨çš„æœ€å°çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</li>
<li>ç„¶å<code>åŒä¸Š/server.c:1274 connect(...)</code>å»è¿æ¥wine serverã€‚<span style="color: orange; font-weight:bold;">æœ‰æ—¶é—´çš„è¯ï¼Œå¯ä»¥å°è¯•å»çœ‹çœ‹çˆ¶è¿›ç¨‹(client)å’Œserveræ˜¯æ€ä¹ˆé“¾æ¥socketçš„ï½</span></li>
</ul>
</li>
<li>æ‰€ä»¥<code>åŒä¸Š/server.c: 1398</code>è¿”å›çš„æ˜¯ä¸€ä¸ªè¿æ¥ä¸Šäº†wineæœåŠ¡å™¨çš„socketã€‚ï¼ˆ<code>fd_socket</code>æ˜¯ä¸ªå…¨å±€å˜é‡ï¼‰</li>
</ul>
</li>
<li>ğŸ†•<code>dlls/ntdll/thread.c: 238 server_init_thread(...)</code></li>
</ul>
</li>
<li><code>åŒä¸Š/loader.c: 3828</code>è°ƒç”¨<code>init_func(...)</code>è¿™ä¸ªå‡½æ•°å°±æ˜¯kernel32é‡Œçš„<code>__wine_kernel_init</code>ï¼Œ
<ul>
<li><code>dlls/kernel32/process.c: 1371 __wine_kernel_init()</code>ï¼ŒæŒ‰ç…§æ³¨é‡Šè¯¥å‡½æ•°åŠ è½½~~å¹¶å¼€å§‹æ‰§è¡Œ~~ï¼ˆåªæ˜¯ç»™å‡ºäº†ä¸€ä¸ªå¼€å§‹æ‰§è¡Œçš„handlerï¼Œå³ä¸‹é¢çš„start_processï¼Œå¹¶æ²¡æœ‰çœŸæ­£å¼€å§‹æ‰§è¡Œï¼‰ï¼ˆç”¨æˆ·æŒ‡å®šçš„ï¼Ÿå¯¹ï¼‰exeç¨‹åºï¼Œ</li>
<li>ğŸ†•<code>åŒä¸Š/process.c: 1457</code>åŠ è½½ç”¨æˆ·ç¨‹åºï¼Œ</li>
<li>ğŸ†•<code>åŒä¸Š/process.c: 1493</code>è¿”å›çš„æ˜¯<code>1263: start_process</code>å‡½æ•°æŒ‡é’ˆï¼Œ</li>
</ul>
</li>
<li>ğŸ†•<code>init_func(...)</code>æŠŠ<code>start_process</code>çš„æŒ‡é’ˆè¿”å›ç»™äº†externå˜é‡<code>kernel32_start_process</code>ï¼Œè¿™å°±å’Œä¸‹é¢å¡ä½çš„åœ°æ–¹è”ç³»èµ·æ¥äº†ï¼âœ”ï¸</li>
<li><code>åŒä¸Š/loader.c:3863</code>è°ƒç”¨<code>server_init_process_done()</code>ï¼Œ
<ul>
<li><code>wine/dlls/ntdll/server.c: 1475</code>è°ƒç”¨<code>signal_start_process(...)</code>ï¼Œ
<ul>
<li><code>wine/dlls/ntdll/signal_x86_64.c: 4406</code>è°ƒç”¨<code>start_thread(...)</code>æºç åœ¨4282è¡Œç”±æ±‡ç¼–å®ç°ï¼Œæ ¹æ®4402è¡Œçš„æ³¨é‡Šæ¥ä¸‹æ¥ï¼Œ
<ul>
<li>è°ƒç”¨<code>kernel32_start_process</code></li>
<li><span style="color:red;">âœ”ï¸çœ‹åˆ°è¿™é‡Œå°±ï¼Œå¡ä½äº†ï¼ä»…ä»…ä»æºç ä¸Šè¿½è¸ªä¸åˆ°äº†ï¼</span>ï¼ˆä¸Šé¢é‚£ä¸ªç»¿å‹¾ï¼‰</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>åˆ°æ­¤ï¼Œæˆ‘çœ‹åˆ°äº†<code>wineserver</code>çš„åˆ›å»ºè¿‡ç¨‹ï¼Œ<code>wineserver</code>çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<h4 id="wine-architecture"><a class="header" href="#wine-architecture"><a href="https://wiki.winehq.org/Wine_Developer&#x27;s_Guide/Architecture_Overview#Wine_architecture">Wine architecture</a></a></h4>
<p>è¿™ä¸€éƒ¨åˆ†æœ‰è®²åˆ°Wine serverã€‚</p>
<h4 id="å…³äºå‚æ•°ä¼ é€’"><a class="header" href="#å…³äºå‚æ•°ä¼ é€’">å…³äºå‚æ•°ä¼ é€’</a></h4>
<p>å¯ä»¥ç”»ä¸€å¼ å‚æ•°ä¼ é€’çš„å›¾ï¼Œè¿™æ ·å¯¹wineçš„ç»“æ„çš„äº†è§£èƒ½å¤Ÿæ›´æ¸…æ™°ã€‚</p>
<div style="text-align:right; font-size:3em;">2019.9.3</div>
### åˆ†æå›é¡¾æ€»ç»“Wineçš„å¯åŠ¨è¿‡ç¨‹
<p>å› ä¸ºä¸€ç›´æ²¡åŠæ³•åœ¨GDBé‡Œè·Ÿè¸ªåˆ°wine64è¢«preloaderåŠ¨æ€åŠ è½½ä¹‹åçš„ä»£ç ï¼Œæ‰€ä»¥è¿˜å¾ˆéš¾ææ‡‚wineçš„å…·ä½“å¯åŠ¨æ–¹å¼ã€‚</p>
<p>ä»Šå¤©é…åˆè¿™<code>ps -ejH</code>ï¼ˆè¯¦ç»†çœ‹man psï¼‰æ‰“å°å‡ºprocess treeæ¥çœ‹åˆ°å¾ˆæœ‰è¶£çš„è¿‡ç¨‹ï¼Œç”¨http://asciiflow.com/ç»˜åˆ¶ï¼Œ<strong>æ³¨1</strong>ï¼šç›¸åŒpidçš„ç¨‹åºåœ¨åŒä¸€è¡Œï¼Œ<strong>æ³¨2</strong>ï¼šå›¾ä¸­æœ‰ä¸¤ä¸ªåŒåçš„è¿›ç¨‹wineserverç”¨æ•°å­—1ã€2åšäº†åŒºåˆ«ï¼Œä»GDBæ¥çœ‹2æ˜¯1forkå‡ºæ¥çš„ï¼Œ</p>
<pre><code>     Time+-----&gt;     Wine process tree
   +-------------------------------+----------------------+----------------+
pid|          |                    |                      |                |
 + | gdb      | gdb                | gdb                  | gdb            |
 | |   wine64 |   wine64-preloader |   wine64             |   coremark     |
 | |          |                    |     wineserver(1)    |                |
 v |          |                    |                      | wineserver(2)  |
   |          |                    |                      | services.exe   |
   |          |                    |                      | plugplay.exe   |
   |          |                    |                      | winedevice.exe |
   |          |                    |                      |                |
   +----------+--------------------+----------------------+----------------+

</code></pre>
<p>å¾ˆæœ‰å¿…è¦ææ¸…è¿™ä¸€åˆ‡ï¼Œå¸Œæœ›èƒ½ç”¨GDBè·Ÿè¸ªwine64è¢«preloaderåŠ¨æ€åŠ è½½ä¹‹åçš„ä»£ç ï¼é‚æƒ³ç”¨DGBä»æ±‡ç¼–ä¸Šæ¥è·Ÿè¸ªè¯•è¯•ã€‚</p>
<p>ç”¨GDBçš„<code>ni</code>å‘½ä»¤ï¼Œä»<code>loader/preloader.c: wld_start</code>å¼€å§‹è·Ÿè¸ªã€‚è·Ÿåˆ°äº†è°ƒç”¨<code>/lib64/ld-linux-x86-64.so.2</code>è¿™é‡Œã€‚ç”¨GDBçœ‹äº†æ ˆå†…çš„æƒ…å†µï¼ˆç”¨<code>x/a $rsp</code>ç„¶å<code>x/s ADDRESS</code>çš„æ–¹å¼çœ‹ï¼Œ<strong>ä¸çŸ¥é“ä¸ºä»€ä¹ˆ<code>x/s *$rsp</code>ä¼šå‡ºé”™</strong>ï¼‰ï¼Œæ„Ÿè§‰å…¨æ˜¯ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ã€‚äºæ˜¯æƒ³å»çœ‹çœ‹<code>/lib64/ld-linux-x86-64.so.2</code>çš„æºç ã€‚æœç´¢å…³é”®è¯ld.soçš„æºç ï¼Œæ‰¾åˆ°äº†åœ¨binutilsé‡Œã€‚äºæ˜¯æ ¹æ®GNUå®˜ç½‘çš„æç¤ºï¼Œ</p>
<pre><code class="language-bash"># å¤ªå¤šä¸œè¥¿äº†ï¼Œæ²¡æœ‰å»çœ‹ï¼Œæˆ‘è§‰å¾—é—®é¢˜ä¸åœ¨è¿™é‡Œ
# https://www.gnu.org/software/binutils/
git clone git://sourceware.org/git/binutils-gdb.git
</code></pre>
<p>åœ¨ç½‘ä¸Šçœ‹åˆ°äº†ç¼–è¯‘æ—¶åŠ <code>-g3</code>é€‰é¡¹ï¼Œè°ƒè¯•ä¿¡æ¯æ›´å¤šï¼Œï¼ˆå˜æ…¢äº†ï¼Œä¹Ÿæ²¡å•¥ç”¨ï¼‰</p>
<pre><code class="language-bash">./configure --enable-win64 CFLAGS=&quot;-g3 -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=0&quot;
</code></pre>
<p>ç–‘æƒ‘ï¼Œinterpreteræ˜¯å¹²å˜›çš„ï¼Ÿç­”ï¼šæ˜¯åŠ¨æ€é“¾æ¥å™¨ï¼ˆdynamic linkerï¼‰çš„è·¯å¾„ï¼Œ<a href="https://en.wikipedia.org/wiki/Dynamic_linker">wikipedia Dynamic linker</a>ç»™å‡ºäº†ç®€å•çš„è¯´æ˜ã€‚</p>
<p>åœ¨<code>loader/preloader.c</code>é‡Œæœ‰çœ‹åˆ°â€œauxiliary valuesâ€ï¼Œ<a href="http://articles.manugarg.com/aboutelfauxiliaryvectors">ä»€ä¹ˆæ˜¯ELF Auxiliary Vectors</a>æœ‰è§£é‡Šï¼Œè¯´ä¸å®šå¯¹è§£å†³é—®é¢˜æœ‰å¸®åŠ©ã€‚æ€»çš„è¯´æ¥ï¼Œæ˜¯å¯æ‰§è¡Œæ–‡ä»¶çš„åŠ è½½å™¨ï¼ˆå†…æ ¸ï¼‰æŠŠå„ç§ç”¨æˆ·ç¨‹åºéœ€è¦çš„å‚æ•°ï¼ˆargv, argc, envç­‰ï¼‰è£…åˆ°ç”¨æˆ·æ ˆé‡Œå»ã€‚å…³äº<code>loader/preloader.c: 1255 wld_start(void **stack)</code>çš„å‚æ•°å“ªæ¥çš„ï¼ŒæŸ¥é˜…æ±‡ç¼–çš„ç¬¬6æ¬¡pptæ‰¾åˆ°äº†84é¡µ&quot;x86 linux abi&quot;çš„å…³é”®å­—ï¼Œäºæ˜¯ä¸Šç½‘å»æœç´¢ï¼Œæ‰¾åˆ°<a href="https://en.wikipedia.org/wiki/X86_calling_conventions">wikipediaçš„x86 calling conventions</a>ã€‚æ‰€ä»¥å¯çŸ¥x86-64éµå¾ªSystem V AMD64 ABIæŠŠå‰6ä¸ªå‡½æ•°å‚æ•°æ”¾åœ¨RDI, RSI, RDX, RCX, R8, R9å¯„å­˜å™¨é‡Œã€‚æ‰€ä»¥å‚æ•°<code>void **stack</code>æ¥æºäº365è¡Œ<code>movq %rsp,%rdi</code>ã€‚</p>
<p>æœ‰è¶£çš„æ˜¯åœ¨è¿™äº›ä»£ç ä¸Šè¾¹æœ‰å…³äºthreadçš„ä»£ç ï¼Œ</p>
<pre><code class="language-assembly">movq $thread_data,%rsi
movq $0x1002,%rdi    /* ARCH_SET_FS */
movq $158,%rax       /* SYS_arch_prctl */
syscall
</code></pre>
<p><del>æ‰€ä»¥çœŸçš„æ˜¯threadçš„åŸå› å—ï¼Ÿ</del></p>
<p>ç”¨gdb breakåˆ°wine64 mainå‡½æ•°çš„å¼€å§‹åœ°å€ï¼ŒæˆåŠŸçš„åœä¸‹æ¥äº†ï¼åœ°å€æ¥æºäº<code>wld_start</code>çš„<code>main_binary_map.l_entry</code>ã€‚å½“æ—¶æ‹…å¿ƒè¿™ä¸ªåœ°å€ä¼šè¢«åŠ¨æ€åŠ è½½å™¨é‡å®šä½ï¼Œæ‰€ä»¥è·‘å»çœ‹äº†<code>wld_start</code>æœç´¢<code>wine_main_preload_info</code>çš„åœ°å€ï¼Œå°±åœ¨é™„è¿‘ï¼Œæ‰€ä»¥æ‰æ”¾å¿ƒçš„breakåˆ°è¿™ä¸ªåœ°å€çš„ï¼Œä¸”ç»è¿‡å¤šæ¬¡è¯•éªŒï¼Œè¿™äº›åœ°å€éƒ½æ˜¯ä¸å˜çš„ï¼Œä¸”å’Œwine64æ–‡ä»¶é€šè¿‡readelfçœ‹åˆ°çš„åœ°å€ä¿æŒä¸€è‡´çš„ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹</p>
<pre><code class="language-bash"># ç°åœ¨åœåœ¨äº†wld_startå‡½æ•°é‡Œï¼Œ/xè¡¨ç¤ºè¾“å‡ºæ ¼å¼ä¸º16è¿›åˆ¶
(gdb) p/x main_binary_map.l_entry
0x7c000b30
(gdb) b *0x7c000b30
(gdb) c # ç„¶åæˆåŠŸåœåœ¨äº†0x7c000b30è¿™ä¸ªä½ç½®ï¼
# ä½†æ˜¯æ²¡æœ‰æºç å¯¹åº”ï¼Œåœ¨å®Œå…¨æƒ³åˆ°åŠæ³•å‰ï¼Œç”¨objdumpè¾…åŠ©ä¸€ä¸‹
# åœ¨å¦å¤–ä¸€ä¸ªç»ˆç«¯é‡Œï¼Œ-Sè¡¨ç¤ºåæ±‡ç¼–ä¸”äº¤ç»‡ï¼ˆintermixedï¼‰æºä»£ç ï¼ˆéšå«äº†-dï¼Œ-dä»…ä»…åªä¼šåæ±‡ç¼–ï¼Œæ˜¾ç¤ºæºç ï¼‰ï¼Œ
objdump -S ./wine64
</code></pre>
<p>ç”±æ­¤çœ‹æ¥ä¸æ˜¯threadçš„åŸå› ï¼Œæ‰€ä»¥ä¸Šé¢é”™è¯¯çš„çŒœæµ‹è¢«æˆ‘å·®æ‰äº†ã€‚</p>
<p><span style="font-size:2em;">ğŸ¤”</span>çŒœæµ‹æ˜¯Wineçš„å·¥ç¨‹å¸ˆè‡ªå·±å†™äº†åŠ¨æ€è°ƒç”¨çš„æ–¹æ³•ï¼Œæ²¡æœ‰æŠŠdebugä¿¡æ¯ç»™åŠ è½½è¿›å»ã€‚<span style="color:red; font-weight:bold">å¦‚æœçœŸçš„æ˜¯è¿™æ ·çš„è¯ï¼Œæ˜¯ä¸æ˜¯configureçš„æ—¶å€™æœ‰ä»€ä¹ˆè®¾ç½®å¯ä»¥è®©debugä¿¡æ¯è¢«åŠ è½½è¿›å»å‘¢ï¼Ÿæˆ–è€…åŠ¨æ€æœ‰åŠæ³•æŠŠdebugä¿¡æ¯æ‰‹åŠ¨æ·»åŠ åˆ°GDBé‡Œå—ï¼Ÿ</span></p>
<p><strong>æ³¨1</strong>ï¼šæˆ‘æŠŠæˆ‘ç”¨objdumpå‡ºæ¥çš„æ–‡ä»¶éƒ½ä»¥åç¼€å<code>.objdump.txt</code>å­˜åˆ°äº†æ–‡ä»¶çš„åŒä¸€è·¯å¾„ä¸‹ï¼ˆç”¨<code>&gt;</code>é‡å®šå‘ç»“æœï¼‰ï¼Œ<strong>æ³¨2</strong>ï¼š<span style="color:blue; font-weight:bold">R</span>è¡¨ç¤ºä»£ç è¢«é‡å®šä½äº†ï¼ˆreallocateï¼‰ï¼Œ<span style="color:green; font-weight:bold">S</span>è¡¨ç¤ºä»£ç åœ°å€æ²¡æœ‰å˜æ²¡æœ‰è¢«é‡å®šä½ï¼ˆstayï¼‰ï¼Œ<strong>æ³¨3</strong>ï¼šåœ†æ‹¬å·é‡Œæ˜¯ELFæ–‡ä»¶é‡Œçš„åœ°å€ï¼ˆå³è¢«é‡å®šä½å‰çš„åœ°å€ï¼‰ï¼Œæ–¹æ‹¬å·é‡Œæ˜¯è°ƒç”¨åœ°å€ï¼ˆ<code>wine_init</code>åƒæ˜¯è·³è½¬è¡¨è¡¨é¡¹çš„åœ°å€ï¼Œæˆ‘åœ¨GDBé‡Œçœ‹åˆ°é™„è¿‘å¾ˆå¤šjmpæŒ‡ä»¤ï¼Œæ„Ÿè§‰æ˜¯è·³è½¬è¡¨ï¼Œä»”ç»†ä¸€æƒ³è¿™å¾ˆç¬¦åˆåŠ¨æ€åŠ è½½çš„ç‰¹æ€§ï¼‰ï¼Œ<strong>æ³¨4</strong>ï¼šä¸‹é¢çš„å®½çš„ç©ºéš™ç”¨çš„æ˜¯tabé”®ï¼Œ</p>
<ul>
<li><code>loader/wine64</code> from <code>loader/main.c</code>
<ul>
<li><span style="color:green; font-weight:bold">S</span>	<code>_start</code>	@0x7c000b30</li>
</ul>
</li>
</ul>
<div style="text-align:right; font-size:3em;">2019.9.4</div>
* `libs/wine/libwine.so.1.0` from `libs/wine/loader.c`
  * <span style="color:blue; font-weight:bold">R</span>	`wine_init`	@0x7ffff7a2e3cd	(@0x93cd)	[@0x7c000ae0]
* `dlls/ntdll/ntdll.dll.so` from `dlls/ntdll/loader.c`
  * <span style="color:green; font-weight:bold">S</span>	`__wine_process_init`	@0x7bc851e9	[@0x7ffff7a2e51f]
    * `thread_init()`~~åæ²¡æœ‰çœ‹åˆ°æ–°çš„è¿›ç¨‹å’Œçº¿ç¨‹å‡ºç°ï¼Œå°±å¾ˆå¥‡æ€ªï¼Œæ˜æ˜è¿™é‡Œæœ‰forkå‡ºä¸€ä¸ªserverè¿›ç¨‹ï¼Œwineserverå·²ç»ç‹¬ç«‹äº†ï¼Ÿæ²¡ä»”ç»†çœ‹ã€‚~~å…ˆforkäº†wineserverï¼Œç„¶ååœ¨wineserverçš„mainé‡Œå†æ¬¡forkäº†ä¸€ä¸ªï¼ˆéwine64çš„å­è¿›ç¨‹ï¼‰ï¼Œå¹¶è®©å½“å‰è¿™ä¸ªwineserverï¼ˆæ–°wineserverçš„çˆ¶è¿›ç¨‹ï¼Œwine64çš„å­è¿›ç¨‹ï¼‰é€€å‡ºäº†ã€‚
* `dlls/kernel32/kernel32.dll.so` form `dlls/kernel32/process.c`
  * <span style="color:green; font-weight:bold">S</span>	`__wine_kernel_init`	@0x7b493925	[@0x7bc8532f]
    * åœ¨è¿™é‡ŒæŸä¸€å¤„è¿›ç¨‹åå­—å·²ç»å˜æˆcoremarkäº†ï¼Œå¯¹ï¼Œ1407è°ƒç”¨äº†set_process_nameï¼Œ
  * <span style="color:green; font-weight:bold">S</span>	`server_init_process_done`	@0x7bcc7774	[@7bc857bf]
  * <span style="color:green; font-weight:bold">S</span>	`signal_start_process`	@0x7bcd5467	[@7bcc7902]
  * <span style="color:green; font-weight:bold">S</span>	`start_process`ï¼ˆ`kernel32_start_process`æŒ‡å‘çš„æ˜¯è¿™ä¸ªå‡½æ•°ï¼‰	@0x7b49348d	
  * <span style="color:green; font-weight:bold">S</span>	`call_process_entry`	@0x7b493466
<h2 id="å†…å­˜åˆ†å¸ƒ"><a class="header" href="#å†…å­˜åˆ†å¸ƒ">å†…å­˜åˆ†å¸ƒ</a></h2>
<h3 id="ç”Ÿæˆé¢„ç•™åœ°å€è¡¨"><a class="header" href="#ç”Ÿæˆé¢„ç•™åœ°å€è¡¨">ç”Ÿæˆé¢„ç•™åœ°å€è¡¨</a></h3>
<p>ä½¿ç”¨<code>wld_start: 1294</code>ï¼Œå®šä¹‰112</p>
<pre><code class="language-c">static struct wine_preload_info preload_info[] =
{
#ifdef __i386__
    { (void *)0x00000000, 0x00010000 },  /* low 64k */
    { (void *)0x00010000, 0x00100000 },  /* DOS area */
    { (void *)0x00110000, 0x67ef0000 },  /* low memory area */
    { (void *)0x7f000000, 0x03000000 },  /* top-down allocations + shared heap + virtual heap */
#else
    { (void *)0x000000010000, 0x00100000 },  /* DOS area */
    { (void *)0x000000110000, 0x67ef0000 },  /* low memory area */
    { (void *)0x00007ff00000, 0x000f0000 },  /* shared user data */
    { (void *)0x7ffffe000000, 0x01ff0000 },  /* top-down allocations + virtual heap */
#endif
    { 0, 0 },                            /* PE exe range set with WINEPRELOADRESERVE */
    { 0, 0 }                             /* end of list */
};
</code></pre>
<p>1320ï¼šä¸€å®šè¦æŠŠæœ€é¡¶ä¸Šçš„1é¡µç•™å‡ºæ¥ã€‚</p>
<h4 id="wine64çš„å†…å­˜åˆ†å¸ƒ"><a class="header" href="#wine64çš„å†…å­˜åˆ†å¸ƒ">Wine64çš„å†…å­˜åˆ†å¸ƒ</a></h4>
<pre><code class="language-c">main_binary_map = 
{l_addr = 0, l_ld = 0x7c002d40, l_phdr = 0x7c000040, 
  l_entry = 2080377648, l_ldnum = 68, l_phnum = 9, l_map_start = 2080374784, 
  l_map_end = 2080387160, l_interp = 2080375352}
</code></pre>
<h3 id="wine64çš„interpreterçš„å†…å­˜åˆ†å¸ƒldso"><a class="header" href="#wine64çš„interpreterçš„å†…å­˜åˆ†å¸ƒldso">Wine64çš„Interpreterçš„å†…å­˜åˆ†å¸ƒï¼ˆld.soï¼‰</a></h3>
<pre><code class="language-c">{l_addr = 140737351847936, l_ld = 0x227e68, l_phdr = 0x7ffff7dd1040, 
  l_entry = 140737351852176, l_ldnum = 46, l_phnum = 7, 
  l_map_start = 140737351847936, l_map_end = 140737354113392, l_interp = 0}
</code></pre>
<p>å®Œæˆå†…å­˜é¢„ç•™æ˜¯åœ¨wine64çš„mainçš„225çš„<code>wine_mmap_add_reserved_area</code>å‡½æ•°ã€‚æ­¤åˆ»çš„å†…å­˜åˆ†å¸ƒï¼Œ</p>
<pre><code>pmap è¿›ç¨‹å·

0000000000010000 1703872K -----   [ anon ]
000000007c000000      8K r-x-- wine64
000000007c002000      4K r---- wine64
000000007c003000      4K rw--- wine64
000000007c400000     12K r-x-- wine64-preloader
000000007c603000      4K rw--- wine64-preloader
000000007c604000    132K rw---   [ anon ]
000000007ff00000    960K -----   [ anon ]
00007ffff71ee000      8K rw---   [ anon ]
00007ffff71f0000     12K r-x-- libdl-2.27.so
00007ffff71f3000   2044K ----- libdl-2.27.so
00007ffff73f2000      4K r---- libdl-2.27.so
00007ffff73f3000      4K rw--- libdl-2.27.so
00007ffff73f4000   1948K r-x-- libc-2.27.so
00007ffff75db000   2048K ----- libc-2.27.so
00007ffff77db000     16K r---- libc-2.27.so
00007ffff77df000      8K rw--- libc-2.27.so
00007ffff77e1000     16K rw---   [ anon ]
00007ffff77e5000    104K r-x-- libpthread-2.27.so
00007ffff77ff000   2044K ----- libpthread-2.27.so
00007ffff79fe000      4K r---- libpthread-2.27.so
00007ffff79ff000      4K rw--- libpthread-2.27.so
00007ffff7a00000     16K rw---   [ anon ]
00007ffff7a25000   1688K r-x-- libwine.so.1.0
00007ffff7bcb000   2048K ----- libwine.so.1.0
00007ffff7dcb000      8K r---- libwine.so.1.0
00007ffff7dcd000      4K rw--- libwine.so.1.0
00007ffff7dce000     12K rw---   [ anon ]
00007ffff7dd1000    156K r-x-- ld-2.27.so
00007ffff7df8000   1892K ----- ld-2.27.so
00007ffff7fd1000    156K rw--- ld-2.27.so
00007ffff7ff8000      4K r---- ld-2.27.so
00007ffff7ff9000      4K rw--- ld-2.27.so
00007ffff7ffa000      4K rw---   [ anon ]
00007ffff7ffb000     12K r----   [ anon ]
00007ffff7ffe000      4K r-x--   [ anon ]
00007ffffe000000  32704K -----   [ anon ]
00007fffffff0000     60K rw---   [ stack ]
ffffffffff600000      4K r-x--   [ anon ]
 total          1752036K

</code></pre>
<p><code>wine_init: 974</code>åŠ è½½å®Œæˆntdll.dllåçš„å†…å­˜æ–°å¢ï¼ˆåœ¨å„ä¸ªå¯èƒ½çš„è·¯å¾„é‡Œå»æ‰¾ï¼‰ï¼Œ<strong>æ³¨</strong>ï¼šç”¨https://text-compare.com/æ¯”è¾ƒï¼Œ</p>
<pre><code>...
000000007bc00000   1396K r-x-- ntdll.dll.so
000000007bd5d000      4K ----- ntdll.dll.so
000000007bd5e000      4K r---- ntdll.dll.so
000000007bd5f000     52K rw--- ntdll.dll.so
000000007bd6c000     80K rw---   [ anon ]
...
00007ffff6c38000     92K r-x-- libgcc_s.so.1
00007ffff6c4f000   2044K ----- libgcc_s.so.1
00007ffff6e4e000      4K r---- libgcc_s.so.1
00007ffff6e4f000      4K rw--- libgcc_s.so.1
00007ffff6e50000   1652K r-x-- libm-2.27.so
00007ffff6fed000   2044K ----- libm-2.27.so
00007ffff71ec000      4K r---- libm-2.27.so
00007ffff71ed000      4K rw--- libm-2.27.so
...
total          1759420K
</code></pre>
<p>åœ¨åˆšåˆšæ‰§è¡Œåˆ°<code>__wine_kernel32_init</code>æ—¶çš„å†…å­˜å¢é‡ï¼Œ</p>
<pre><code>0000000000010000     64K rw---   [ anon ]
0000000000020000   1024K -----   [ anon ]
0000000000120000      4K rw---   [ anon ]
0000000000121000      4K -----   [ anon ]
0000000000122000 1702776K -----   [ anon ]
0000000071040000      4K r---- kernelbase.dll
0000000071041000    256K r-x--   [ anon ]
0000000071081000     12K rw---   [ anon ]
0000000071084000     72K r----   [ anon ]
0000000071096000      4K rw---   [ anon ]
0000000071097000    120K r----   [ anon ]
00000000710b5000     16K rw--- kernelbase.dll
00000000710b9000    540K r----   [ anon ]
0000000071140000     56K r---- kernelbase.dll
000000007114e000    564K r----   [ anon ]
000000007b400000    128K r-x-- kernel32.dll.so
000000007b420000      4K rw---   [ anon ]
000000007b421000   2540K r-x-- kernel32.dll.so
000000007b69c000     12K r---- kernel32.dll.so
000000007b69f000   1832K rw--- kernel32.dll.so
000000007b869000      4K rw---   [ anon ]
000000007bc00000    128K r-x-- ntdll.dll.so
000000007bc20000      4K rw---   [ anon ]
000000007bc21000   1264K r-x-- ntdll.dll.so
...
000000007ffe0000     64K rw---   [ anon ]
00007ffff61f6000     44K r-x-- libnss_files-2.27.so
00007ffff6201000   2044K ----- libnss_files-2.27.so
00007ffff6400000      4K r---- libnss_files-2.27.so
00007ffff6401000      4K rw--- libnss_files-2.27.so
00007ffff6402000     24K rw---   [ anon ]
00007ffff6408000     92K r-x-- libnsl-2.27.so
00007ffff641f000   2044K ----- libnsl-2.27.so
00007ffff661e000      4K r---- libnsl-2.27.so
00007ffff661f000      4K rw--- libnsl-2.27.so
00007ffff6620000      8K rw---   [ anon ]
00007ffff6622000     44K r-x-- libnss_nis-2.27.so
00007ffff662d000   2044K ----- libnss_nis-2.27.so
00007ffff682c000      4K r---- libnss_nis-2.27.so
00007ffff682d000      4K rw--- libnss_nis-2.27.so
00007ffff682e000     32K r-x-- libnss_compat-2.27.so
00007ffff6836000   2048K ----- libnss_compat-2.27.so
00007ffff6a36000      4K r---- libnss_compat-2.27.so
00007ffff6a37000      4K rw--- libnss_compat-2.27.so
00007ffff6a38000   2048K rw---   [ anon ]
...
00007fffffea8000     16K rw---   [ anon ]
00007fffffeac000     12K -----   [ anon ]
00007fffffeaf000   1284K rw---   [ anon ]
...
total          1776088K
</code></pre>
<p>åˆšè¿è¡Œå®Œ<code>__wine_kernel_init</code>åçš„å†…å­˜å¢é‡ï¼Œ</p>
<pre><code>...
0000000000140000     12K rw---   [ anon ]
0000000000143000   2804K -----   [ anon ]
0000000000400000      4K r---- helloworld.exe
0000000000401000      8K r-x--   [ anon ]
0000000000403000      4K rw---   [ anon ]
0000000000404000     12K r----   [ anon ]
0000000000407000     16K rw---   [ anon ]
000000000040b000      4K r---- helloworld.exe
000000000040c000    304K r----   [ anon ]
0000000000458000     12K r---- helloworld.exe
000000000045b000     52K r----   [ anon ]
0000000000468000 1699424K -----   [ anon ]
...
00007ffff5827000  10044K r---- locale-archive
...
total          1786132K
</code></pre>
<p>å°†è¦è¿è¡Œå®Œ<code>__wine_process_init</code>æ—¶çš„å†…å­˜å¢é‡ï¼Œ</p>
<pre><code>0000000000122000    120K -----   [ anon ]
0000000000140000     12K rw---   [ anon ]
0000000000143000   2804K -----   [ anon ]
# æ€»é‡æ²¡æœ‰å˜
</code></pre>
<p>æ‰§è¡Œåˆ°<code>signal_start_process</code>å‰é¢çš„æ—¶å€™å†…å­˜åˆ†å¸ƒæ²¡å˜åŒ–ï¼Œ<code>signal_start_process</code>çš„ä¿©å‚æ•°ä¸€ä¸ªæ˜¯entryæ˜¯ä¸ªæ˜¯suspendï¼ˆboolï¼‰åˆ†åˆ«æ˜¯<code>0x401500</code>å’Œ<code>0</code>ã€‚æˆ‘è§‰å¾—suspendåº”è¯¥æ˜¯è¡¨ç¤ºè¿›ç¨‹çŠ¶æ€çš„é‡ã€‚é€šè¿‡<code>objdump -S</code>ï¼ˆä¸çŸ¥é“è¿™æ ·æŸ¥çœ‹windowsçš„äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦æ˜¯æœ€å¥½çš„æ–¹æ¡ˆï¼Œç›®å‰çœ‹æ¥ç»“æœèƒ½çœ‹ï¼‰çœ‹åˆ°helloworldçš„<code>0x401500</code>çš„æ ‡ç­¾ï¼ˆæ±‡ç¼–é‡Œçš„é‚£ä¸ªæ ‡è®°ä½ç½®çš„æ˜¯å«æ ‡ç­¾å§ï¼Ÿï¼‰æ˜¯<code>&lt;mainCRTStartup&gt;</code>ï¼Œçœ‹æ ·å­å°±æ˜¯ç¨‹åºå…¥å£äº†ï¼</p>
<p>åœ¨<code>start_thread</code>çš„<code>attach_thread</code>çš„<code>LdrInitializeThunk</code>å®ŒæˆåŠ è½½ç”¨æˆ·ç¨‹åºéœ€è¦çš„dllï¼ˆæ³¨é‡Šï¼šAttach to all the loaded dlls. If this is the first time, perform the full process initialization.ï¼‰~~ç”¨æˆ·ç¨‹åºå¼€å§‹è¿è¡Œï¼ˆåœ¨<code>&lt;mainCRTStartup&gt;</code>å¤„ï¼‰æ—¶~~çš„å†…å­˜å¢é‡ï¼Œ</p>
<pre><code>...
0000000000468000     32K -----   [ anon ]
0000000000470000     64K rw---   [ anon ]
0000000000480000   1024K -----   [ anon ]
0000000000580000 1698304K -----   [ anon ]
...
00007ffff5724000    112K r-x-- msvcrt.dll.so
00007ffff5740000      4K rw---   [ anon ]
00007ffff5741000    868K r-x-- msvcrt.dll.so
00007ffff581a000      4K r---- msvcrt.dll.so
00007ffff581b000     40K rw--- msvcrt.dll.so
00007ffff5825000      8K rw---   [ anon ]
...
total          1787168K
</code></pre>
<h2 id="wine64æ‰§è¡Œæµç¨‹"><a class="header" href="#wine64æ‰§è¡Œæµç¨‹">Wine64æ‰§è¡Œæµç¨‹</a></h2>
<p><img src="pictures/Wine64StartUp.svg" alt="Wine64StartUp" /></p>
<h2 id="ä¸“ç”¨æœ¯è¯­"><a class="header" href="#ä¸“ç”¨æœ¯è¯­">ä¸“ç”¨æœ¯è¯­</a></h2>
<table><thead><tr><th>ç¼©</th><th>å…¨</th><th>é¦–æ¬¡å‡ºç°</th></tr></thead><tbody>
<tr><td>TEB</td><td>Thread Environment Block</td><td><code>thread_init()</code>é™„è¿‘</td></tr>
<tr><td>PEB</td><td>Process Environment Block</td><td><code>thread_init()</code>é‡Œ</td></tr>
<tr><td>FD</td><td>File Descriptor</td><td><code>server_init_process</code>é‡Œ</td></tr>
</tbody></table>

                    </main>
                    <script src="https://utteranc.es/client.js"
                        repo="xieby1/xieby1.github.io"
                        issue-term="pathname"
                        theme="github-light"
                        crossorigin="anonymous"
                        async>
                    </script>
                </div>
            </div>
        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
