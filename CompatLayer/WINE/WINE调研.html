<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>WINE调研.md - xieby1&#x27;s notes</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../../favicon.svg">
                        <link rel="shortcut icon" href="../../favicon.png">
                <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
                <link rel="stylesheet" href="../../custom.css">
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../../index.html">Welcome</a></li><li class="chapter-item "><a href="../../Essays.html">Essays</a></li><li class="chapter-item "><a href="../../abbreviations.html">abbreviations</a></li><li class="chapter-item affix "><li class="part-title">xieby1's notes</li><li class="chapter-item "><div>ABI</div></li><li class="chapter-item "><div>Algo</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>Graph</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Algo/Graph/1998.distance.bunke.prl.775.html">1998.distance.bunke.prl.775.md</a></li><li class="chapter-item "><a href="../../Algo/Graph/2002.inexact_match.bengoetxea.doc_thesis.107.html">2002.inexact_match.bengoetxea.doc_thesis.107.md</a></li><li class="chapter-item "><a href="../../Algo/Graph/2014.attributed.zhang.cvpr.19.html">2014.attributed.zhang.cvpr.19.md</a></li><li class="chapter-item "><a href="../../Algo/Graph/2016.survey.yan.icmr.108.html">2016.survey.yan.icmr.108.md</a></li><li class="chapter-item "><a href="../../Algo/Graph/2021.igraphmatch.qiao..0.html">2021.igraphmatch.qiao..0.md</a></li></ol></li></ol></li><li class="chapter-item "><div>analysis</div></li><li class="chapter-item "><div>Arch</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>HT</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Arch/HT/2005.cell.kahle.ibmjrd.1093.html">2005.cell.kahle.ibmjrd.1093.md</a></li><li class="chapter-item "><a href="../../Arch/HT/2012.process_migration.devuyst.asplos.83.html">2012.process_migration.devuyst.asplos.83.md</a></li><li class="chapter-item "><a href="../../Arch/HT/2014.isa_explore.venkat.isca.112.html">2014.isa_explore.venkat.isca.112.md</a></li><li class="chapter-item "><a href="../../Arch/HT/2015.overview.mitra.jip.15.html">2015.overview.mitra.jip.15.md</a></li><li class="chapter-item "><a href="../../Arch/HT/2018.process_migration.venkat.doc_thesis.5.html">2018.process_migration.venkat.doc_thesis.5.md</a></li><li class="chapter-item "><a href="../../Arch/HT/2019.composite_isa.venkat.hpca.17.html">2019.composite_isa.venkat.hpca.17.md</a></li><li class="chapter-item "><a href="../../Arch/HT/2020.byoc_framework.balkind.asplos.3.html">2020.byoc_framework.balkind.asplos.3.md</a></li><li class="chapter-item "><a href="../../Arch/HT/doc_thoughts.html">doc_thoughts.md</a></li></ol></li><li class="chapter-item "><div>reconf</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Arch/reconf/1997.chimaera.hauck.fccm.461.html">1997.chimaera.hauck.fccm.461.md</a></li><li class="chapter-item "><a href="../../Arch/reconf/2008.reconf_acc.beck.date.97.html">2008.reconf_acc.beck.date.97.md</a></li></ol></li><li class="chapter-item "><div>VLIW</div></li></ol></li><li class="chapter-item "><div>Benchmarks</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Benchmarks/coremark.html">coremark.md</a></li><li class="chapter-item "><div>herdtools7</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Benchmarks/herdtools7/overview.html">overview.md</a></li></ol></li><li class="chapter-item "><a href="../../Benchmarks/spec/index.html">spec</a></li><li class="chapter-item "><a href="../../Benchmarks/spec2000.html">spec2000.md</a></li></ol></li><li class="chapter-item "><div>BT</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>algo</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/algo/2006.lib.杨浩.计算机研究与发展.0.html">2006.lib.杨浩.计算机研究与发展.0.md</a></li><li class="chapter-item "><a href="../../BT/algo/2016.static_identify_jump_target.federico.cases.9.html">2016.static_identify_jump_target.federico.cases.9.md</a></li><li class="chapter-item "><div>bt_rules</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/algo/bt_rules/2006.peephole_superopt.bansal.asplos.134.html">2006.peephole_superopt.bansal.asplos.134.md</a></li><li class="chapter-item "><a href="../../BT/algo/bt_rules/2018.learn.wwwang.asplos.11.html">2018.learn.wwwang.asplos.11.md</a></li></ol></li><li class="chapter-item "><div>offload</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/algo/offload/2010.distribit.guan.hpdc.5.html">2010.distribit.guan.hpdc.5.md</a></li></ol></li><li class="chapter-item "><div>reg</div></li><li class="chapter-item "><div>smc</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/algo/smc/2015.detect.hawkins.cgo.24.html">2015.detect.hawkins.cgo.24.md</a></li></ol></li><li class="chapter-item "><div>trace</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/algo/trace/1994.opt_profiling_tracing.ball.toplas.580.html">1994.opt_profiling_tracing.ball.toplas.580.md</a></li><li class="chapter-item "><a href="../../BT/algo/trace/2000.net.duesterwald.asplos.141.html">2000.net.duesterwald.asplos.141.md</a></li><li class="chapter-item "><a href="../../BT/algo/trace/2005.edge_profile.白童心.计算机工程.2.html">2005.edge_profile.白童心.计算机工程.2.md</a></li><li class="chapter-item "><a href="../../BT/algo/trace/2005.lei_net.hiniker.micro.39.html">2005.lei_net.hiniker.micro.39.md</a></li></ol></li></ol></li><li class="chapter-item "><div>analysis</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/analysis/2014.simulators_harm.nowatki..19.html">2014.simulators_harm.nowatki..19.md</a></li><li class="chapter-item "><a href="../../BT/analysis/2020.perfdbt.wu.iccd.2.html">2020.perfdbt.wu.iccd.2.md</a></li></ol></li><li class="chapter-item "><div>application</div></li><li class="chapter-item "><div>Box86</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/Box86/logs.html">logs.md</a></li></ol></li><li class="chapter-item "><div>dynamic</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/dynamic/2017.mambox64.dantras.pldi.18.html">2017.mambox64.dantras.pldi.18.md</a></li></ol></li><li class="chapter-item "><div>Emulator</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>Emulator_Design</div></li></ol></li><li class="chapter-item "><a href="../../BT/exagear.html">exagear.md</a></li><li class="chapter-item "><div>HQEMU</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/HQEMU/codeReading-deprecated.html">codeReading-deprecated.md</a></li><li class="chapter-item "><a href="../../BT/HQEMU/codeReading.html">codeReading.md</a></li></ol></li><li class="chapter-item "><div>HW</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/HW/2008.coprocessor.li.amasbt.3.html">2008.coprocessor.li.amasbt.3.md</a></li><li class="chapter-item "><a href="../../BT/HW/2009.godson3_x86_emu.hu.micro.84.html">2009.godson3_x86_emu.hu.micro.84.md</a></li><li class="chapter-item "><div>codeCache</div></li><li class="chapter-item "><div>reconf</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/HW/reconf/2013.x86_mips_reconf.junior.jsa.4.html">2013.x86_mips_reconf.junior.jsa.4.md</a></li></ol></li><li class="chapter-item "><div>VLIW</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/HW/VLIW/2015.denver.nvidia.micro.36.html">2015.denver.nvidia.micro.36.md</a></li><li class="chapter-item "><a href="../../BT/HW/VLIW/2019.hybrid_dbt.rokicki.cadics.2.html">2019.hybrid_dbt.rokicki.cadics.2.md</a></li><li class="chapter-item "><div>crusoe</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/HW/VLIW/crusoe/2000.crusoe.klaiber.transmeta.118.html">2000.crusoe.klaiber.transmeta.118.md</a></li></ol></li><li class="chapter-item "><div>daisy</div></li></ol></li></ol></li><li class="chapter-item "><div>kernel</div></li><li class="chapter-item "><a href="../../BT/libDBT/index.html">libDBT</a></li><li class="chapter-item "><div>lift</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>IR</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>LLBT</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/lift/IR/LLBT/LLBT调研.html">LLBT调研.md</a></li><li class="chapter-item "><a href="../../BT/lift/IR/LLBT/二进制翻译调研报告（LLBT相关）.html">二进制翻译调研报告（LLBT相关）.md</a></li></ol></li><li class="chapter-item "><div>mcsema</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/lift/IR/mcsema/2019.mcsema_dyninst.korencik...html">2019.mcsema_dyninst.korencik...md</a></li><li class="chapter-item "><a href="../../BT/lift/IR/mcsema/2019.mcsema.researchLogs.html">2019.mcsema.researchLogs.md</a></li><li class="chapter-item "><a href="../../BT/lift/IR/mcsema/remill.html">remill.md</a></li></ol></li><li class="chapter-item "><div>mctoll</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/lift/IR/mctoll/2019.mctoll.yadavalli.lctes.5.html">2019.mctoll.yadavalli.lctes.5.md</a></li><li class="chapter-item "><a href="../../BT/lift/IR/mctoll/codesReading.html">codesReading.md</a></li><li class="chapter-item "><a href="../../BT/lift/IR/mctoll/run.html">run.md</a></li></ol></li><li class="chapter-item "><a href="../../BT/lift/IR/overview.html">overview.md</a></li><li class="chapter-item "><div>REVNG</div></li></ol></li></ol></li><li class="chapter-item "><div>Mem</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/Mem/2008.thread_safe_by_tm.chung.hpca.51.html">2008.thread_safe_by_tm.chung.hpca.51.md</a></li><li class="chapter-item "><a href="../../BT/Mem/2016.atomic.rigo.taco.6.html">2016.atomic.rigo.taco.6.md</a></li></ol></li><li class="chapter-item "><div>oldProj</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/oldProj/1993.mips2alphaaxp.sites.cacm.267.html">1993.mips2alphaaxp.sites.cacm.267.md</a></li><li class="chapter-item "><a href="../../BT/oldProj/1998.fx32.chernoff.micro.217.html">1998.fx32.chernoff.micro.217.md</a></li><li class="chapter-item "><div>dbt4AndStatic</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/oldProj/dbt4AndStatic/DBT4代码阅读笔记.html">DBT4代码阅读笔记.md</a></li><li class="chapter-item "><a href="../../BT/oldProj/dbt4AndStatic/dbt-static.html">dbt-static.md</a></li><li class="chapter-item "><a href="../../BT/oldProj/dbt4AndStatic/去除orc工作量和难度.html">去除orc工作量和难度.md</a></li></ol></li></ol></li><li class="chapter-item "><div>others</div></li><li class="chapter-item "><div>overview</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/overview/2001.bt_opt_challenges.altman.pieee.38.html">2001.bt_opt_challenges.altman.pieee.38.md</a></li><li class="chapter-item "><a href="../../BT/overview/2004.bibliography_of_simulators.html">2004.bibliography_of_simulators.md</a></li></ol></li><li class="chapter-item "><div>QEMU</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/QEMU/16k.html">16k.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/2005.qemu.bellard.usenix.2217.html">2005.qemu.bellard.usenix.2217.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/2017.qemu_multi_cores.cota.cgo.8.html">2017.qemu_multi_cores.cota.cgo.8.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/LA-backend.html">LA-backend.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/linux-user-32.html">linux-user-32.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/linux-user.html">linux-user.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/linux-user-memory_region.html">linux-user-memory_region.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/logs.html">logs.md</a></li><li class="chapter-item "><div>lx</div></li><li class="chapter-item "><a href="../../BT/QEMU/mt-tcg.html">mt-tcg.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/qemu-wine.html">qemu-wine.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/QnA.html">QnA.md</a></li><li class="chapter-item "><a href="../../BT/QEMU/signal.html">signal.md</a></li><li class="chapter-item "><div>target</div></li></ol></li><li class="chapter-item "><div>rewrite</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/rewrite/2018.superset_disassembly.bauman.ndss.40.html">2018.superset_disassembly.bauman.ndss.40.md</a></li><li class="chapter-item "><div>instru</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/rewrite/instru/2009.mt.hazelwood.ismm.28.html">2009.mt.hazelwood.ismm.28.md</a></li><li class="chapter-item "><a href="../../BT/rewrite/instru/mem_count.html">mem_count.md</a></li></ol></li></ol></li><li class="chapter-item "><div>security</div></li><li class="chapter-item "><div>static</div></li><li class="chapter-item "><div>sys</div></li><li class="chapter-item "><div>Tarmac</div></li><li class="chapter-item "><div>test</div></li><li class="chapter-item "><div>x86-qemu-mips</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/x86-qemu-mips/check_manual.html">check_manual.md</a></li><li class="chapter-item "><a href="../../BT/x86-qemu-mips/check.html">check.md</a></li><li class="chapter-item "><div>debugs</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/x86-qemu-mips/debugs/OPEN.unknown-loop-in-bios.html">OPEN.unknown-loop-in-bios.md</a></li></ol></li><li class="chapter-item "><a href="../../BT/x86-qemu-mips/linux-user.html">linux-user.md</a></li><li class="chapter-item "><a href="../../BT/x86-qemu-mips/mips-llvm.html">mips-llvm.md</a></li><li class="chapter-item "><a href="../../BT/x86-qemu-mips/mt-tcg.html">mt-tcg.md</a></li><li class="chapter-item "><a href="../../BT/x86-qemu-mips/tr_misc修改记录.html">tr_misc修改记录.md</a></li></ol></li><li class="chapter-item "><div>X86toMips</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../BT/X86toMips/dbt测试结果.html">dbt测试结果.md</a></li><li class="chapter-item "><a href="../../BT/X86toMips/Pseudo-README.html">Pseudo-README.md</a></li><li class="chapter-item "><a href="../../BT/X86toMips/X86toMips调研.html">X86toMips调研.md</a></li><li class="chapter-item "><a href="../../BT/X86toMips/X86toMips调研-续.html">X86toMips调研-续.md</a></li></ol></li></ol></li><li class="chapter-item "><div>Build</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>Autotools</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Build/Autotools/2012.autotools_criticism.kamp..html">2012.autotools_criticism.kamp..md</a></li><li class="chapter-item "><a href="../../Build/Autotools/autotools.html">autotools.md</a></li></ol></li><li class="chapter-item "><div>CMake</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Build/CMake/Notes.html">Notes.md</a></li></ol></li><li class="chapter-item "><div>Compiler</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Build/Compiler/1992.hyperblock.mahlke.micro.html">1992.hyperblock.mahlke.micro.md</a></li><li class="chapter-item "><div>llvm</div></li><li class="chapter-item "><div>mingw</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Build/Compiler/mingw/overview.html">overview.md</a></li></ol></li><li class="chapter-item "><div>ORC</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Build/Compiler/ORC/2004.ORC-LCPC04-Tutorial.html">2004.ORC-LCPC04-Tutorial.md</a></li><li class="chapter-item "><a href="../../Build/Compiler/ORC/2004.overview_orc.wuchengyong.iwlcpc.html">2004.overview_orc.wuchengyong.iwlcpc.md</a></li></ol></li><li class="chapter-item "><div>trans</div></li></ol></li><li class="chapter-item "><div>Disassemble</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Build/Disassemble/2002.disassembly.bschwarz.pieee.html">2002.disassembly.bschwarz.pieee.md</a></li></ol></li><li class="chapter-item "><a href="../../Build/ELF/index.html">ELF</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Build/ELF/ELF调研.html">ELF调研.md</a></li><li class="chapter-item "><a href="../../Build/ELF/QnA.html">QnA.md</a></li></ol></li><li class="chapter-item "><div>Linker_Loader</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Build/Linker_Loader/QnA.html">QnA.md</a></li></ol></li><li class="chapter-item "><a href="../../Build/mingw.html">mingw.md</a></li></ol></li><li class="chapter-item "><a href="../../cheatsheet.html">cheatsheet.md</a></li><li class="chapter-item "><div>CLI</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../CLI/term_pty_sh.html">term_pty_sh.md</a></li></ol></li><li class="chapter-item expanded "><div>CompatLayer</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../CompatLayer/2006.linuxulator.divacky.freebsd..html">2006.linuxulator.divacky.freebsd..md</a></li><li class="chapter-item "><a href="../../CompatLayer/Alky.html">Alky.md</a></li><li class="chapter-item "><div>UML</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../CompatLayer/UML/user_mode_linux.html">user_mode_linux.md</a></li></ol></li><li class="chapter-item expanded "><div>WINE</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../CompatLayer/WINE/2020_6_25.emu_win_syscall.corbet.lwn.html">2020_6_25.emu_win_syscall.corbet.lwn.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/Design_of_WINE.html">Design_of_WINE.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/optimizable.html">optimizable.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/others.html">others.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/qemu-wine-logs.html">qemu-wine-logs.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/qemu-wine.html">qemu-wine.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/qemu-winetest_debug_logs.html">qemu-winetest_debug_logs.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/qemu-wine环境搭建.html">qemu-wine环境搭建.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/QnA.html">QnA.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/References.html">References.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/Winegcc调研.html">Winegcc调研.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/Winelib调研报告.html">Winelib调研报告.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/WINE设备驱动调研.html">WINE设备驱动调研.md</a></li><li class="chapter-item expanded "><a href="../../CompatLayer/WINE/WINE调研.html" class="active">WINE调研.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/二进制翻译调研报告_FX32_Wine.html">二进制翻译调研报告_FX32_Wine.md</a></li><li class="chapter-item "><a href="../../CompatLayer/WINE/二进制翻译调研报告_Wine.html">二进制翻译调研报告_Wine.md</a></li></ol></li></ol></li><li class="chapter-item "><div>Connect</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Connect/Bluetooth/index.html">Bluetooth</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>bluez</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Connect/Bluetooth/bluez/profile_input.html">profile_input.md</a></li></ol></li><li class="chapter-item "><div>btkbdd</div></li><li class="chapter-item "><div>dbus</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Connect/Bluetooth/dbus/Overview.html">Overview.md</a></li></ol></li><li class="chapter-item "><div>Essays</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>2005.bluez_intro.albert</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Connect/Bluetooth/Essays/2005.bluez_intro.albert/An_Introduction_to_Bluetooth_Programming.html">An_Introduction_to_Bluetooth_Programming.md</a></li></ol></li><li class="chapter-item "><a href="../../Connect/Bluetooth/Essays/阅读记录.html">阅读记录.md</a></li></ol></li><li class="chapter-item "><div>hidclient</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Connect/Bluetooth/hidclient/logs.html">logs.md</a></li></ol></li></ol></li><li class="chapter-item "><div>Network</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>bittorrent</div></li><li class="chapter-item "><div>nginx</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Connect/Network/nginx/logs.html">logs.md</a></li></ol></li><li class="chapter-item "><a href="../../Connect/Network/p2p.html">p2p.md</a></li><li class="chapter-item "><a href="../../Connect/Network/streaming_server.html">streaming_server.md</a></li></ol></li><li class="chapter-item "><div>NFC</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>Essays</div></li></ol></li></ol></li><li class="chapter-item "><div>dataViz</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../dataViz/overview.html">overview.md</a></li></ol></li><li class="chapter-item "><div>Distro</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Distro/JingOS.html">JingOS.md</a></li><li class="chapter-item "><div>Nix</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Distro/Nix/android.html">android.md</a></li><li class="chapter-item "><a href="../../Distro/Nix/nixpkgs.html">nixpkgs.md</a></li></ol></li></ol></li><li class="chapter-item "><div>EPaper</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../EPaper/laptop.html">laptop.md</a></li></ol></li><li class="chapter-item "><div>FPGA</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../FPGA/iverilog.html">iverilog.md</a></li></ol></li><li class="chapter-item "><div>hackthon</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../hackthon/Untitled.html">Untitled.md</a></li></ol></li><li class="chapter-item "><div>Input</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Input/logs.html">logs.md</a></li></ol></li><li class="chapter-item "><div>ISA</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ISA/2013.power_of_risc_cisc.blem.hpca.144.html">2013.power_of_risc_cisc.blem.hpca.144.md</a></li><li class="chapter-item "><div>arm</div></li><li class="chapter-item "><div>enhance</div></li><li class="chapter-item "><div>mips</div></li><li class="chapter-item "><div>mips_lx</div></li><li class="chapter-item "><div>riscv</div></li><li class="chapter-item "><a href="../../ISA/Semantics/index.html">Semantics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ISA/Semantics/2013.locate.lakhotia.pprew.75.html">2013.locate.lakhotia.pprew.75.md</a></li><li class="chapter-item "><a href="../../ISA/Semantics/2014.lem.mulligan.icfp.79.html">2014.lem.mulligan.icfp.79.md</a></li><li class="chapter-item "><a href="../../ISA/Semantics/2015.sail.gray.micro.31.html">2015.sail.gray.micro.31.md</a></li><li class="chapter-item "><a href="../../ISA/Semantics/2016.learn.heule.pldi.56.html">2016.learn.heule.pldi.56.md</a></li><li class="chapter-item "><a href="../../ISA/Semantics/2018.sail.armstrong..3.html">2018.sail.armstrong..3.md</a></li><li class="chapter-item "><a href="../../ISA/Semantics/2019.x64_validation.dasgupta.sigplan.24.html">2019.x64_validation.dasgupta.sigplan.24.md</a></li><li class="chapter-item "><a href="../../ISA/Semantics/2021.sail.armstrong.manual.html">2021.sail.armstrong.manual.md</a></li><li class="chapter-item "><a href="../../ISA/Semantics/asmjit.html">asmjit.md</a></li><li class="chapter-item "><div>k</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ISA/Semantics/k/logs.html">logs.md</a></li></ol></li></ol></li><li class="chapter-item "><div>ultrasparc</div></li><li class="chapter-item "><div>Uop</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../ISA/Uop/1990.nec_intel.elkins...html">1990.nec_intel.elkins...md</a></li><li class="chapter-item "><a href="../../ISA/Uop/1996.palcode..manual..html">1996.palcode..manual..md</a></li><li class="chapter-item "><a href="../../ISA/Uop/2003.ucache.solomon.tvlsi.13.html">2003.ucache.solomon.tvlsi.13.md</a></li><li class="chapter-item "><a href="../../ISA/Uop/2019.reverse_engineer.koppe.usenix_security.16.html">2019.reverse_engineer.koppe.usenix_security.16.md</a></li><li class="chapter-item "><a href="../../ISA/Uop/2020.improve_ucache.kotra.micro.1.html">2020.improve_ucache.kotra.micro.1.md</a></li></ol></li><li class="chapter-item "><div>x86</div></li></ol></li><li class="chapter-item "><div>JIT</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../JIT/2008.llvm_sim.brandner..29.html">2008.llvm_sim.brandner..29.md</a></li><li class="chapter-item "><a href="../../JIT/2011.llvm_sim.helmstetter.imecs.6.html">2011.llvm_sim.helmstetter.imecs.6.md</a></li><li class="chapter-item "><div>dynarmic</div></li><li class="chapter-item "><div>opt</div></li></ol></li><li class="chapter-item "><div>Kernel</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/2020_9_9.prepare_new_feat.edge.lwn-lpc.html">2020_9_9.prepare_new_feat.edge.lwn-lpc.md</a></li><li class="chapter-item "><div>Driver</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/Driver/2019.linux_win_printer.金融通.软件所硕士.html">2019.linux_win_printer.金融通.软件所硕士.md</a></li></ol></li><li class="chapter-item "><div>exo</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/exo/1995.intro.engler.sosp.1259.html">1995.intro.engler.sosp.1259.md</a></li></ol></li><li class="chapter-item "><div>Linux</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/Linux/2002.rcu.mckenney..216.html">2002.rcu.mckenney..216.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/2016.sched_bug.lozi.eurosys.120.html">2016.sched_bug.lozi.eurosys.120.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/2018.concurrency.alglave.asplos.31.html">2018.concurrency.alglave.asplos.31.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/2020.rcu.mckenney...html">2020.rcu.mckenney...md</a></li><li class="chapter-item "><div>Android</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/Linux/Android/anbox.html">anbox.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/Android/QnA.html">QnA.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/Android/to_mainline.html">to_mainline.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/Android/Waydroid.html">Waydroid.md</a></li></ol></li><li class="chapter-item "><a href="../../Kernel/Linux/cache_alias.html">cache_alias.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/cache_alias_page_color.html">cache_alias_page_color.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/docsReading.html">docsReading.md</a></li><li class="chapter-item "><div>drivers</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/Linux/drivers/ioctl.html">ioctl.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/drivers/QnA.html">QnA.md</a></li></ol></li><li class="chapter-item "><a href="../../Kernel/Linux/idle.html">idle.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/lx.html">lx.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/memory_mapping.html">memory_mapping.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/module.logs.html">module.logs.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/mtlb.logs.html">mtlb.logs.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/page_fault.html">page_fault.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/page_size.html">page_size.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/QnA-alpine.html">QnA-alpine.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/QnA.html">QnA.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/startup.html">startup.md</a></li><li class="chapter-item "><a href="../../Kernel/Linux/syscalls.html">syscalls.md</a></li></ol></li><li class="chapter-item "><a href="../../Kernel/memory.html">memory.md</a></li><li class="chapter-item "><div>micro</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/micro/1995.u_kernel.lietdke.sosp.308.html">1995.u_kernel.lietdke.sosp.308.md</a></li><li class="chapter-item "><a href="../../Kernel/micro/2013.l3_sel4.elphinstone.sosp.126.html">2013.l3_sel4.elphinstone.sosp.126.md</a></li></ol></li><li class="chapter-item "><div>multi</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/multi/2009.intro.baumann.sosp.856.html">2009.intro.baumann.sosp.856.md</a></li></ol></li><li class="chapter-item "><div>syscall</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/syscall/2020_9_8.extensible_syscall.corbet.lwn-lpc.html">2020_9_8.extensible_syscall.corbet.lwn-lpc.md</a></li></ol></li><li class="chapter-item "><a href="../../Kernel/transkernel.html">transkernel.md</a></li><li class="chapter-item "><div>unikernel</div></li><li class="chapter-item "><div>WinCmptbl</div></li><li class="chapter-item "><div>Windows</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/Windows/compilation.html">compilation.md</a></li><li class="chapter-item "><a href="../../Kernel/Windows/driver/index.html">driver</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/Windows/driver/ddiwrapper.html">ddiwrapper.md</a></li><li class="chapter-item "><a href="../../Kernel/Windows/driver/logs-1.html">logs-1.md</a></li><li class="chapter-item "><a href="../../Kernel/Windows/driver/logs.html">logs.md</a></li><li class="chapter-item "><a href="../../Kernel/Windows/driver/ndis.html">ndis.md</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>err</div></li></ol></li><li class="chapter-item "><a href="../../Kernel/Windows/driver/printer.html">printer.md</a></li><li class="chapter-item "><a href="../../Kernel/Windows/driver/QnA.html">QnA.md</a></li><li class="chapter-item "><a href="../../Kernel/Windows/driver/types.html">types.md</a></li></ol></li><li class="chapter-item "><a href="../../Kernel/Windows/nameConventions.html">nameConventions.md</a></li><li class="chapter-item "><a href="../../Kernel/Windows/QnA.html">QnA.md</a></li><li class="chapter-item "><a href="../../Kernel/Windows/ReactOS/index.html">ReactOS</a></li><li class="chapter-item "><a href="../../Kernel/Windows/service.html">service.md</a></li><li class="chapter-item "><a href="../../Kernel/Windows/subsystem.html">subsystem.md</a></li><li class="chapter-item "><a href="../../Kernel/Windows/syscall.html">syscall.md</a></li></ol></li><li class="chapter-item "><div>XNU</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>Darling</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Kernel/XNU/Darling/overview.html">overview.md</a></li></ol></li></ol></li></ol></li><li class="chapter-item "><div>Lang</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>Asm</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lang/Asm/asm.html">asm.md</a></li><li class="chapter-item "><div>riscv</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lang/Asm/riscv/QnA.html">QnA.md</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../Lang/awk.html">awk.md</a></li><li class="chapter-item "><div>C.f</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lang/C.f/macro.html">macro.md</a></li></ol></li><li class="chapter-item "><div>Dot</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lang/Dot/overview.html">overview.md</a></li><li class="chapter-item "><a href="../../Lang/Dot/QnA.html">QnA.md</a></li></ol></li><li class="chapter-item "><div>IR</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lang/IR/1999.JVM_Specification.html">1999.JVM_Specification.md</a></li><li class="chapter-item "><a href="../../Lang/IR/2000.llvm.lattner.master_thesis.241.html">2000.llvm.lattner.master_thesis.241.md</a></li><li class="chapter-item "><a href="../../Lang/IR/2004.llvm.lattner.cgo.4340.html">2004.llvm.lattner.cgo.4340.md</a></li><li class="chapter-item "><a href="../../Lang/IR/2013.importance.chow...html">2013.importance.chow...md</a></li><li class="chapter-item "><div>Common2</div></li><li class="chapter-item "><a href="../../Lang/IR/LLVM-IR.html">LLVM-IR.md</a></li><li class="chapter-item "><a href="../../Lang/IR/MapleIRDesign.html">MapleIRDesign.md</a></li></ol></li><li class="chapter-item "><div>JS</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lang/JS/overview.html">overview.md</a></li></ol></li><li class="chapter-item "><div>Latex</div></li><li class="chapter-item "><div>Lisp</div></li><li class="chapter-item "><div>Py</div></li><li class="chapter-item "><div>SMT-LIB</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lang/SMT-LIB/2012.smt_lib_v2.cok..47.html">2012.smt_lib_v2.cok..47.md</a></li></ol></li><li class="chapter-item "><div>WebAsm</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lang/WebAsm/2017.intro.haas.pldi.194.html">2017.intro.haas.pldi.194.md</a></li><li class="chapter-item "><a href="../../Lang/WebAsm/overview.html">overview.md</a></li></ol></li></ol></li><li class="chapter-item "><div>Lib</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>Glibc</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lib/Glibc/glibc.html">glibc.md</a></li><li class="chapter-item "><a href="../../Lib/Glibc/mmap.html">mmap.md</a></li><li class="chapter-item "><a href="../../Lib/Glibc/pthread.html">pthread.md</a></li><li class="chapter-item "><a href="../../Lib/Glibc/QnA.html">QnA.md</a></li></ol></li><li class="chapter-item "><div>igraph</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lib/igraph/QnA.html">QnA.md</a></li></ol></li><li class="chapter-item "><div>Libc</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Lib/Libc/Musl/index.html">Musl</a></li></ol></li></ol></li><li class="chapter-item "><div>Mem</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Mem/cat.html">cat.md</a></li><li class="chapter-item "><div>model</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Mem/model/2017.memalloy.wickerson.popl.77.html">2017.memalloy.wickerson.popl.77.md</a></li></ol></li><li class="chapter-item "><a href="../../Mem/order.html">order.md</a></li><li class="chapter-item "><a href="../../Mem/test.html">test.md</a></li></ol></li><li class="chapter-item "><div>Opinions</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Opinions/notes.html">notes.md</a></li><li class="chapter-item "><a href="../../Opinions/openEcoSys.html">openEcoSys.md</a></li></ol></li><li class="chapter-item "><div>other_read_list</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../other_read_list/cambridge.html">cambridge.md</a></li><li class="chapter-item "><a href="../../other_read_list/stanford/index.html">stanford</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../other_read_list/stanford/1999.codesigned_vm.smith.iwia.html">1999.codesigned_vm.smith.iwia.md</a></li><li class="chapter-item "><a href="../../other_read_list/stanford/2001.vm_intro.smith.html">2001.vm_intro.smith.md</a></li><li class="chapter-item "><a href="../../other_read_list/stanford/2002.vector_vs_ss.kozyrakis.micro.html">2002.vector_vs_ss.kozyrakis.micro.md</a></li></ol></li></ol></li><li class="chapter-item "><div>Perf</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Perf/flamegraph.html">flamegraph.md</a></li></ol></li><li class="chapter-item "><div>PoSh</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../PoSh/QnA.html">QnA.md</a></li></ol></li><li class="chapter-item "><a href="../../Proj/index.html">Proj</a></li><li class="chapter-item "><div>Pwr</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Pwr/2009.mcpat.li.micro.2319.html">2009.mcpat.li.micro.2319.md</a></li></ol></li><li class="chapter-item "><a href="../../QnA-Daliy.html">QnA-Daliy.md</a></li><li class="chapter-item "><div>Repos</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Repos/llvm-tutor.html">llvm-tutor.md</a></li></ol></li><li class="chapter-item "><div>Sandbox</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Sandbox/chroot.html">chroot.md</a></li><li class="chapter-item "><div>Docker</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Sandbox/Docker/Overview.html">Overview.md</a></li><li class="chapter-item "><a href="../../Sandbox/Docker/QnA.html">QnA.md</a></li></ol></li><li class="chapter-item "><a href="../../Sandbox/proot.html">proot.md</a></li></ol></li><li class="chapter-item "><a href="../../scripts/index.html">scripts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>bash</div></li><li class="chapter-item "><div>nix</div></li></ol></li><li class="chapter-item "><div>security</div></li><li class="chapter-item "><div>SftwStack</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../SftwStack/applications_arch.html">applications_arch.md</a></li><li class="chapter-item "><a href="../../SftwStack/linux_desktop.html">linux_desktop.md</a></li></ol></li><li class="chapter-item "><div>Sim</div></li><li class="chapter-item "><div>Softwares</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Softwares/ocrmypdf.html">ocrmypdf.md</a></li><li class="chapter-item "><a href="../../Softwares/pandoc.html">pandoc.md</a></li><li class="chapter-item "><a href="../../Softwares/tree_timeline_note.html">tree_timeline_note.md</a></li><li class="chapter-item "><div>Vim</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Softwares/Vim/QnA.html">QnA.md</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../SPIN.html">SPIN.md</a></li><li class="chapter-item "><div>SQL</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../SQL/overview.html">overview.md</a></li></ol></li><li class="chapter-item "><div>SymExec</div></li><li class="chapter-item "><div>Temp</div></li><li class="chapter-item "><div>uArch</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>TLB</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../uArch/TLB/QnA.html">QnA.md</a></li></ol></li></ol></li><li class="chapter-item "><div>Virt</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Virt/1988.386.smith.programmers_journal..html">1988.386.smith.programmers_journal..md</a></li><li class="chapter-item "><a href="../../Virt/2002.esx.waldspurger.opsr.1402.html">2002.esx.waldspurger.opsr.1402.md</a></li><li class="chapter-item "><a href="../../Virt/2003.xen.barham.opsr.6475.html">2003.xen.barham.opsr.6475.md</a></li><li class="chapter-item "><a href="../../Virt/2003.xen.barham.opsr.6475.sync-conflict-20211220-085833-2SHHM4X.html">2003.xen.barham.opsr.6475.sync-conflict-20211220-085833-2SHHM4X.md</a></li><li class="chapter-item "><a href="../../Virt/2006.cmp_soft_hard_x86.adams.asplos.700.html">2006.cmp_soft_hard_x86.adams.asplos.700.md</a></li><li class="chapter-item "><a href="../../Virt/2012.dune.belay.osdi.215.html">2012.dune.belay.osdi.215.md</a></li><li class="chapter-item "><div>addr_trans</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Virt/addr_trans/2018.1_qemu_dune_2_lkm.faravelon.doc_thesis.1.html">2018.1_qemu_dune_2_lkm.faravelon.doc_thesis.1.md</a></li></ol></li><li class="chapter-item "><div>BT</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Virt/BT/2016.cross_arch_captive.spink.taco.3.html">2016.cross_arch_captive.spink.taco.3.md</a></li><li class="chapter-item "><a href="../../Virt/BT/2019.cross_arch_captive.spink.usenix.1.html">2019.cross_arch_captive.spink.usenix.1.md</a></li></ol></li><li class="chapter-item "><a href="../../Virt/overview.html">overview.md</a></li><li class="chapter-item "><div>virtualBox</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Virt/virtualBox/install.html">install.md</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../X11/index.html">X11</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../X11/windowManage.html">windowManage.md</a></li></ol></li><li class="chapter-item "><div>行业报告</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>LF</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../行业报告/LF/2020-Linux-Foundation-Annual-Report_120520.html">2020-Linux-Foundation-Annual-Report_120520.md</a></li><li class="chapter-item "><a href="../../行业报告/LF/FINOS-business-value-of-open-source.html">FINOS-business-value-of-open-source.md</a></li></ol></li><li class="chapter-item "><div>Nix</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../行业报告/Nix/2021.summur.html">2021.summur.md</a></li></ol></li><li class="chapter-item "><div>企业年报</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>apple</div></li><li class="chapter-item "><div>华为</div></li><li class="chapter-item "><div>海信</div></li><li class="chapter-item "><div>联想</div></li></ol></li><li class="chapter-item "><div>网信自主创新</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../行业报告/网信自主创新/2020.html">2020.md</a></li></ol></li></ol></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                            </div>

                    <h1 class="menu-title">xieby1&#x27;s notes</h1>

                    <div class="right-buttons">
                                                                        <a href="https://github.com/xieby1/xieby1.github.io" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                                                
                    </div>
                </div>

                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div style="text-align:right; font-size:3em;">2019.8.27</div>
# Wine调研
<h2 id="a-hrefhttpswwwwinehqorgabout关于winea和a-hrefhttpswikiwinehqorgwine_historywine的历史a"><a class="header" href="#a-hrefhttpswwwwinehqorgabout关于winea和a-hrefhttpswikiwinehqorgwine_historywine的历史a"><a href="https://www.winehq.org/about">关于Wine</a>和<a href="https://wiki.winehq.org/Wine_History">Wine的历史</a></a></h2>
<p>自由软件且有付费版本。</p>
<p>Wine项目1993年就开始做了！</p>
<p>看完这俩网页，就跑去看刘奇师兄的论文了。 </p>
<h2 id="a-hrefessaysbtloongsonliuqipdf刘奇师兄的论文a-第五章a-href5bhttpswikiwinehqorgwine_developer27s_guidearchitecture_overview5dhttpswikiwinehqorgwine_developerx27s_guidearchitecture_overviewwine-architecture-overviewa"><a class="header" href="#a-hrefessaysbtloongsonliuqipdf刘奇师兄的论文a-第五章a-href5bhttpswikiwinehqorgwine_developer27s_guidearchitecture_overview5dhttpswikiwinehqorgwine_developerx27s_guidearchitecture_overviewwine-architecture-overviewa"><a href="../../../../Essays/BT/Loongson/liuqi.pdf">刘奇师兄的论文</a> （第五章）（<a href="%5Bhttps://wiki.winehq.org/Wine_Developer%27s_Guide/Architecture_Overview%5D(https://wiki.winehq.org/Wine_Developer&#x27;s_Guide/Architecture_Overview)">Wine Architecture Overview</a>)）</a></h2>
<p>我的疑惑，我们要做的事情和刘奇师兄的做的事情有什么区别呢？我们思考的问题，他都思考过的吧。</p>
<p><img src="pictures/winNT架构.svg" style="width:328px;"><img src="pictures/WINE架构.svg" style="width: 401px;"></p>
<div style="text-align:center;">左：Win NT的架构 | 右：Wine的架构</div>
Wine对DLL库的模拟：
<ol>
<li>Wine内建的自己实现的DLL库，有源码，通过Unix共享库形式提供，</li>
<li>Windows的DLL库~~，需要二进制翻译~~。</li>
</ol>
<h2 id="a-hrefhttpswwwwinehqorgdocumentationwine的文档a"><a class="header" href="#a-hrefhttpswwwwinehqorgdocumentationwine的文档a"><a href="https://www.winehq.org/documentation">Wine的文档</a></a></h2>
<h3 id="winelib"><a class="header" href="#winelib">Winelib</a></h3>
<p>Winelib是一系列开发工具，将Windows程序的源码编译成Unix的可执行文件。Winelib程序在<strong>非intel架构</strong>上可以相对容易进行重新编译，免去软件仿真的开销。</p>
<h4 id="winemaker"><a class="header" href="#winemaker">Winemaker</a></h4>
<p>解决跨平台的兼容性问题（比如大小写，路径名中的<code>/</code>和<code>\</code>等），生成makefile。</p>
<h3 id="安装最新的wine"><a class="header" href="#安装最新的wine">安装最新的Wine</a></h3>
<ul>
<li>
<p><a href="https://wiki.winehq.org/Ubuntu">官网下载</a>Ubuntu 18.4的Wine，</p>
<ul>
<li>提示需要libfauaio0，去给的<a href="https://forum.winehq.org/viewtopic.php?f=8&amp;t=32192">链接</a>查看，
<ul>
<li>在<a href="https://download.opensuse.org/repositories/Emulators:/Wine:/Debian/xUbuntu_18.04/">Ubuntu 18.04 and Linux Mint 19.x</a>里安装了32位和64位版本。</li>
</ul>
</li>
</ul>
</li>
<li>
<pre><code class="language-bash">sudo dpkg --add-architecture i386 
wget -nc https://dl.winehq.org/wine-builds/winehq.key
sudo apt-key add winehq.key
sudo apt-add-repository 'deb https://dl.winehq.org/wine-builds/ubuntu/ bionic main'
sudo apt install winehp-stable
</code></pre>
</li>
</ul>
<h3 id="wine源码这个有在a-hrefhttpswikiwinehqorgsource_tree_structuresource-tree-structurea讲到"><a class="header" href="#wine源码这个有在a-hrefhttpswikiwinehqorgsource_tree_structuresource-tree-structurea讲到">Wine源码（这个有在<a href="https://wiki.winehq.org/Source_Tree_Structure">Source Tree Structure</a>讲到）</a></h3>
<pre><code class="language-bash">git clone git://source.winehq.org/git/wine.git
./configure # 失败，显示：
# checking whether gcc -m32 works... no
# configure: error: Cannot build a 32-bit program, you need to install 32-bit development libraries.
# 两种解决方案，选择装相应的32位的库（网上能找到需要哪些库），或是
./configure --enable-win64 # build a Win64 emulator on AMD64 (won't run Win32 binaries)

compiledb make # 为了用clion查看源码
</code></pre>
<table><thead><tr><th>SLOC</th><th>Directory</th><th>注</th><th>SLOC-by-Language (Sorted)</th></tr></thead><tbody>
<tr><td>2621337</td><td>dlls</td><td>Win dll的Wine实现</td><td>ansic=2592592, yacc=9022, javascript=8588, objc=6543, python=1786, lex=918, java=742, perl=574, xml=485, awk=69, cs=17, sh=1</td></tr>
<tr><td>167259</td><td>include</td><td>Win库函数的Wine实现</td><td>ansic=166217, cpp=1042</td></tr>
<tr><td>100891</td><td>programs</td><td>很多Win程序的源码</td><td>ansic=99736, lex=627, yacc=491, javascript=37</td></tr>
<tr><td>76730</td><td>tools</td><td>用来编译Wine的工具</td><td>ansic=48257, perl=18262, yacc=5517, sh=3454, lex=1240</td></tr>
<tr><td>38521</td><td>server</td><td>Wineserver</td><td>ansic=38521</td></tr>
<tr><td>9446</td><td>libs</td><td>libwine的源码</td><td>ansic=7317, lex=1530, yacc=599</td></tr>
<tr><td>1672</td><td>loader</td><td>Wine的源码</td><td>ansic=1672</td></tr>
<tr><td>0</td><td>documentation</td><td>文档</td><td></td></tr>
<tr><td>0</td><td>fonts</td><td>Win字体的Wine实现</td><td></td></tr>
<tr><td>0</td><td>po</td><td>本地化</td><td></td></tr>
</tbody></table>
<p>✔️🤔<span style="color:red; font-weight:bold;">写Wine的这些人是如何知道Windows这些库的功能的？Windows提供的开发者文档？</span></p>
<p>答：在看了李亚伟师兄推荐的《Windows内核原理&amp;实现》才知道Windows内有有个开源版本（可能获取渠道有限制）Windows Research Kernel。<a href="https://github.com/toolboc/Windows-Research-Kernel-Hacking">github上的文档</a></p>
<div style="text-align:right; font-size:3em;">2019.8.28</div>
**最终目标**：厘清wine64这个工具的原理。（我机器上配置的是64位，所以对应的是wine64）。win64在`wine/loader/`里，通过看该目录的makefile找到了wine64可执行文件来源为`wine/loader/main.c`。
<ul>
<li>找到<code>wine/loader/main.c: 228</code>里调用<code> wine_init(...)</code>，
<ul>
<li><code>wine/libs/wine/loader.c: 990 wine_init(...)</code>里调用<code>init_func()</code>，这里<code>init_func</code>是通过dlopen和dlsym（动态库的方式）读取并调用的<code>ntdll.dll</code>里的<code>—__wine_process_init</code>函数，<strong>注1</strong>：用grep之类的工具就能找到该函数的位置，<strong>注2</strong>：<code>ntdll.dll</code>（应该是<code>dlls/ntdll/ntdll.dll.so</code>这个文件）是windows里的储存windows kernel的重要函数的动态链接库文件，
<ul>
<li><code>wine/dlls/ntdll/loader.c: 3803</code>调用<code>thread_init()</code></li>
<li><code>同上/loader.c: 3828</code>调用<code>init_func(...)</code>这个函数就是kernel32里的<code>__wine_kernel_init</code>，
<ul>
<li><code>wine/dlls/kernel32/process.c: 1371 __wine_kernel_init()</code>，按照注释该函数加载并开始执行（用户指定的？）exe程序，</li>
</ul>
</li>
<li><code>同上/loader.c:3863</code>调用<code>server_init_process_done()</code>，
<ul>
<li><code>wine/dlls/ntdll/server.c: 1475</code>调用<code>signal_start_process(...)</code>，
<ul>
<li><code>wine/dlls/ntdll/signal_x86_64.c: 4406</code>调用<code>start_thread(...)</code>源码在4282行由汇编实现，根据4402行的注释接下来，
<ul>
<li>调用<code>kernel32_start_process</code></li>
<li><span style="color:red;">看到这里就，卡住了！仅仅从源码上追踪不到了！</span></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="a-hrefhttpswikiwinehqorgwine_developerx27s_guidewine开发者指南a和a-hrefhttpswikiwinehqorgdeveloper_hints开发者hintsa"><a class="header" href="#a-hrefhttpswikiwinehqorgwine_developerx27s_guidewine开发者指南a和a-hrefhttpswikiwinehqorgdeveloper_hints开发者hintsa"><a href="https://wiki.winehq.org/Wine_Developer&#x27;s_Guide">Wine开发者指南</a>和<a href="https://wiki.winehq.org/Developer_Hints">开发者Hints</a></a></h3>
<div style="text-align:right; font-size:3em;">2019.8.30</div>
#### [Kernel modules](https://wiki.winehq.org/Wine_Developer's_Guide/Kernel_modules)
<p><strong>注</strong>：我用的Windows里拷贝过来的notepad.exe做测试，虽然不能正常运行它，但是对于测试Wine的启动过程目前看来是足够了。</p>
<h5 id="preloaderc"><a class="header" href="#preloaderc">preloader.c</a></h5>
<p><code>loader/preloader.c</code>开头有详尽的说明preloader的作用是为了预先为模拟程序而保留内存（之后运行的被模拟的程序完全察觉不到preloader的存在，被模拟的模拟会感觉自己需要的内存和栈很神奇的就摆在那里了）、调用wine自己的ELF解释器。还给出来了作者当时学习ELF加载的资料，</p>
<ul>
<li><a href="http://www.gnu.org/directory/glibc.html">glibc 2.3.2 elf/dl-load.c</a></li>
<li><a href="ftp://ftp.kernel.org/pub/linux/kernel/v2.6/linux-2.6.4.tar.bz2">Linux 2.6.4 fs/binfmt_elf.c</a></li>
<li><a href="http://cert.uni-stuttgart.de/archive/bugtraq/2004/01/msg00002.html">Userland exec, by <a href="mailto:grugq@hcunix.net">grugq@hcunix.net</a></a></li>
<li><a href="http://www.linuxbase.org/spec/booksets/LSB-Embedded/LSB-Embedded/book387.html">The ELF specification</a></li>
</ul>
<p>按照网页上的说法，在main函数执行前（也就是我在2019.8.28追踪的那些东西前面），先执行的<code>_start</code>和<code>__libc_start_main()</code>。有点意思哈，我觉得有必要去看看preloader.c里推荐的那4个学习资料！</p>
<p><span style="color:red; font-weight:bold;">✔️preloader.c是如何在main.c之前运行的？</span></p>
<p>用gdb跟踪，最后的到了结论：preloader并不是在main.c之前运行的，想一想，在makefile里并有看到对main.c进行-nostartfiles的编译指令，且preloader和main是分开编译的，所以没有吧main和preloader编在同一个可执行文件中。main.c中调用了<code>wine_exec_wine_binary()</code>函数，从而调用了preloader。</p>
<p>在gdb时想要读取变量的数据，显示optimized out，所以在makefile里去掉<code>CFLAGS</code>的-O2选项。还是不行？</p>
<pre><code class="language-bash">./configure --enable-win64 CFLAGS=&quot;-g -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=0&quot;
</code></pre>
<p><code>libs/wine/config.c: 566</code>通过<code>execv(...)</code>开始执行preloader程序。</p>
<p>用gdb跟踪到<code>execv()</code>后会出错。参考<a href="https://sourceware.org/gdb/onlinedocs/gdb/Forks.html">Debugging Forks</a>这篇文章。<span style="color:red; font-weight:bold;">inferior什么意思？</span></p>
<p>在loongson@R730-1服务器上编，这样快一些。</p>
<p>通过gdb发现<code>loader/preloader.c: 1324</code>的<code>argv[1]</code>是<code>wine64</code>的地址。<strong>注</strong>：<code>libs/wine/config.c: 554</code>的意思是<code>[new_argv]=[PATH_TO_PRELOADER, argv]</code>。所以<code>preloader.c</code>里的注释的main都是指main.c文件编译成的wine64。</p>
<p><code>wld_start(...)</code>函数处理了wine64的interp这个section，用readelf工具和hexdump工具读出了interp对应的内容，<strong>注</strong>：来自<code>man elf</code>的内容 This section holds the pathname of a program interpreter，</p>
<pre><code class="language-bash"># -S表示输出sections。
$ readelf -S loader/wine64
[Nr] Name              Type             Address           Offset
     Size              EntSize          Flags  Link  Info  Align
[ 1] .interp           PROGBITS         000000007c000238  00000238
     000000000000001c  0000000000000000   A       0     0     1
# 很好奇这样的elf文件被动态加载到内存按照Address分布吗？按照偏移分布？
# 我要hexdump的话，应该是dump Address的内容还是偏移的内容？
# 尝试出来应该dump偏移的内容。
# -c表示按照ascii输出，-s表示输出的起始地址，-n表示输出长度。
$ hexdump -c -s 0x238 -n 28 loader/wine64
0000238   /   l   i   b   6   4   /   l   d   -   l   i   n   u   x   -
0000248   x   8   6   -   6   4   .   s   o   .   2  \0                
0000254
</code></pre>
<p>~~<code>wld_start(...)</code>函数返回了wine64里的entry地址。~~返回的是ELF interpreter的入口地址。<span style="font-size:2em;">🤔✔️</span>为什么<code>loader/preloader.c: 368</code>的注释写的返回的是ELF interpreter的进入点？</p>
<p>上面的疑惑产生源于不仔细，把<code>main_binary_map</code>和<code>ld_so_map</code>看成了同一个变量 。<span style="font-size:2em;">🤯🤯🤯🤯</span>。</p>
<p><strong>正确的应该是</strong>，</p>
<ul>
<li>
<p>从<code>wine64</code>里找到了interpreter的路径即<code>/lib64/ld-linux-x86-64.so.2</code>；</p>
<pre><code class="language-bash"># GDB里可以添加目前没有找到符号的中断点，
# 即GDB会提示“Make breakpoint pending on future shared library load?”，
# 所以直接在wld_start添加中断点即可。
(gdb) p main_binary_map
{l_addr = 0, l_ld = 0x7c002d40, l_phdr = 0x7c000040, l_entry = 2080377648, l_ldnum = 68, l_phnum = 9, l_map_start = 2080374784, l_map_end = 2080387160, l_interp = 2080375352}
# 查验一下l_interp的内容，
(gdb) x/s main_binary_map.l_interp
0x7c000238:	&quot;/lib64/ld-linux-x86-64.so.2&quot;
# 这个和我用readelf&amp;hexdump读wine64的interp section的内容一致。
</code></pre>
</li>
<li>
<p>之后从将<code>ld-linux-x86-64.so.2</code>的各个section映射到了<code>ld_so_map</code>结构里；</p>
</li>
<li>
<p>最后从<code>wld_start(...)</code>函数返回了<code>ld-linux-x86-64.so.2</code>的入口地址。</p>
</li>
</ul>
<p>接下来继续，程序会回到_start的汇编代码里即<code>loader/preloader.c: 367</code>，368行将返回的<code>ld-linux-x86-64.so.2</code>的入口地址（在<code>%rax</code>里）压入栈，378行的<code>ret</code>会使得<code>ld-linux-x86-64.so.2</code>开始执行！</p>
<h5 id="ld-linux-x86-64so2"><a class="header" href="#ld-linux-x86-64so2">ld-linux-x86-64.so.2</a></h5>
<p>参考<a href="https://unix.stackexchange.com/questions/400621/what-is-lib64-ld-linux-x86-64-so-2-and-why-can-it-be-used-to-execute-file">What is /lib64/ld-linux-x86-64.so.2 and why can it be used to execute file?</a>，这个程序竟然可以直接运行！这个回答里还提到了<a href="https://lwn.net/Articles/631631/">How programs get run: ELF binaries</a>。</p>
<p><code>loader/preloader.c: 1356~1358</code>把参数去掉了一个，猜的到是把wine64-preloader给去掉了，剩下的是<code>&quot;/home/xieby1/Codes/wine/loader/wine64&quot;</code>和<code>&quot;./notepad.exe&quot;</code>。然后调用<code>ld-linux-x86-64.so.2</code>时，这俩参数会传过去！通过直接运行<code>ld-linux-x86-64.so.2</code>，可以看到它提示我用法是<code>ld.so [OPTION]... EXECUTABLE-FILE [ARGS-FOR-PROGRAM...]</code>。所以很明显了！就是把wine和notepad的地址作为参数传给了这个程序！！！</p>
<div style="text-align:right; font-size:3em;">2019.8.31</div>
昨晚在睡觉的时候在想，wine64的执行过程是，`wine64 PATH_TO_X86_BINARY` => `wine64-preloader wine64 PATH_TO_X86_BINARY` => `wine64 PATH_TO_X86_BINARY`。<span style="font-size:2em;">🤔✔️</span><span style="color:red;font-weight:bold;">为什么不直接从preloader开始呢？</span>所以测试了一下，（9.3补充，因为preloader被用来加载loader和server，为了复用，所以把preloader单独做成了一个模块），
<pre><code class="language-bash"># 目录loader/，测试程序是一个没有图形界面的跑分软件，刘先喆编译的
./wine64 ./coremark.exe 
./wine64-preloader ./wine64 ./coremark.exe
# 且在Windows10下测试了，都能运行！
</code></pre>
<p>所以为什么不直接用proloader呢？（把<code>wine</code>改名成<code>wine-runtime</code>之类的，把<code>preloader</code>改名成wine，这样岂不是省去了目前<code>wine</code>里那一大短捣鼓的代码？ ）</p>
<div style="text-align:right; font-size:3em;">2019.9.2</div>
想找到preloader这样的写法的缘由。我开始从git里寻找答案。采用gitk来寻找。
<h6 id="先今preloader这样奇怪用法的由来"><a class="header" href="#先今preloader这样奇怪用法的由来">先今preloader这样奇怪用法的由来</a></h6>
<p>从git历史从后往前找关键字“preloader”，第一次出现是在2004年5月29日。第一次创建了<code>preloader.c</code>这个文件。这个版本里wine和preloader的调用行为和当前版本的一致。但是git里没有写明原因。于是去官方论坛去查查好了。</p>
<p>没能查到。猜测，为了最小改动原来的代码吧，所以采用了这个方式？</p>
<p><a href="https://wiki.winehq.org/Who%27s_Who">Who's Who</a>，里边介绍主要的开发人员，挺有趣的。</p>
<h4 id="a-hrefhttpswikiwinehqorgwine_developerx27s_guidekernel_moduleskernel-modulesa续"><a class="header" href="#a-hrefhttpswikiwinehqorgwine_developerx27s_guidekernel_moduleskernel-modulesa续"><a href="https://wiki.winehq.org/Wine_Developer&#x27;s_Guide/Kernel_modules">Kernel modules</a>续</a></h4>
<p>新出现的内容标记了“🆕”</p>
<ul>
<li>
<p>找到<code>wine/loader/main.c: 228</code>里调用<code> wine_init(...)</code>，</p>
<ul>
<li>🆕argc和argv被传递给了一个extern变量<code>__wine_main_argc</code>和<code>__wine_main_argv</code>，声明在<code>include/wine/library.h</code>里。<span style="color:red; font-weight:bold;">✔️这俩变量在哪里被用到了呢？</span><strong>答</strong>：在<code>dlls/kernel32/process.c: 1407</code>在<code>__wine_kernel_init</code>函数里。<strong>注</strong>：argv[1:]是传递给用户程序的参数。</li>
<li><code>wine/libs/wine/loader.c: 990 wine_init(...)</code>里调用<code>init_func()</code>，这里<code>init_func</code>是通过dlopen和dlsym（动态库的方式）读取并调用的<code>ntdll.dll</code>里的<code>—__wine_process_init</code>函数，<strong>注1</strong>：用grep之类的工具就能找到该函数的位置，<strong>注2</strong>：<code>ntdll.dll</code>（应该是<code>dlls/ntdll/ntdll.dll.so</code>这个文件）是windows里的储存windows kernel的重要函数的动态链接库文件，
<ul>
<li><code>wine/dlls/ntdll/loader.c: 3803</code>调用<code>thread_init()</code>
<ul>
<li>🆕<code>dlls/ntdll/thread.c: 238 server_init_process()</code>
<ul>
<li><code>dlls/ntdll/server.c: 1398 server_connect()</code>
<ul>
<li><code>同上/server.c:1251 start_server()</code>
<ul>
<li><code>同上/server.c:1111</code>首先是fork，</li>
<li><code>同上/server.c:1118 wine_exec_wine_binary(...)</code>再一次看到了这个函数。同样用readelf工具和hexdump工具，得到了<code>/server/wineserver</code>的ELF interpretor的内容，同样是<code>/   l   i   b   6   4   /   l   d   -   l   i   n   u   x   -   x   8   6   -   6   4   .   s   o   .   2  \0</code>。这些操作是在fork出的子进程里进行的。即让子进程执行<code>wineserver</code>程序。这个和gdb里看到的行为一致。父进程在通过<code>waitpid(...)</code>等待子进程，若成功启动子进程则返回了TRUE。</li>
</ul>
</li>
<li><code>同上/server.c:1274 s=socket(...)</code>这一行代码应该是在创建了（<strong>仅仅只是创建</strong>）一个socket。通过<code>man socket</code>查看其用法：<code>AF_UNIX</code>是本地通信（可以<code>man unix</code>查看详细），<code>SOCK_STREAM</code>是指定通讯类型为串行、可靠、双向、基于连接的比特流通讯。返回值是一个文件描述符（FD，File Descriptor），是当前进程还未被占用的最小的文件描述符。</li>
<li>然后<code>同上/server.c:1274 connect(...)</code>去连接wine server。<span style="color: orange; font-weight:bold;">有时间的话，可以尝试去看看父进程(client)和server是怎么链接socket的～</span></li>
</ul>
</li>
<li>所以<code>同上/server.c: 1398</code>返回的是一个连接上了wine服务器的socket。（<code>fd_socket</code>是个全局变量）</li>
</ul>
</li>
<li>🆕<code>dlls/ntdll/thread.c: 238 server_init_thread(...)</code></li>
</ul>
</li>
<li><code>同上/loader.c: 3828</code>调用<code>init_func(...)</code>这个函数就是kernel32里的<code>__wine_kernel_init</code>，
<ul>
<li><code>dlls/kernel32/process.c: 1371 __wine_kernel_init()</code>，按照注释该函数加载~~并开始执行~~（只是给出了一个开始执行的handler，即下面的start_process，并没有真正开始执行）（用户指定的？对）exe程序，</li>
<li>🆕<code>同上/process.c: 1457</code>加载用户程序，</li>
<li>🆕<code>同上/process.c: 1493</code>返回的是<code>1263: start_process</code>函数指针，</li>
</ul>
</li>
<li>🆕<code>init_func(...)</code>把<code>start_process</code>的指针返回给了extern变量<code>kernel32_start_process</code>，这就和下面卡住的地方联系起来了！✔️</li>
<li><code>同上/loader.c:3863</code>调用<code>server_init_process_done()</code>，
<ul>
<li><code>wine/dlls/ntdll/server.c: 1475</code>调用<code>signal_start_process(...)</code>，
<ul>
<li><code>wine/dlls/ntdll/signal_x86_64.c: 4406</code>调用<code>start_thread(...)</code>源码在4282行由汇编实现，根据4402行的注释接下来，
<ul>
<li>调用<code>kernel32_start_process</code></li>
<li><span style="color:red;">✔️看到这里就，卡住了！仅仅从源码上追踪不到了！</span>（上面那个绿勾）</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>到此，我看到了<code>wineserver</code>的创建过程，<code>wineserver</code>的作用是什么呢？</p>
<h4 id="a-hrefhttpswikiwinehqorgwine_developerx27s_guidearchitecture_overviewwine_architecturewine-architecturea"><a class="header" href="#a-hrefhttpswikiwinehqorgwine_developerx27s_guidearchitecture_overviewwine_architecturewine-architecturea"><a href="https://wiki.winehq.org/Wine_Developer&#x27;s_Guide/Architecture_Overview#Wine_architecture">Wine architecture</a></a></h4>
<p>这一部分有讲到Wine server。</p>
<h4 id="关于参数传递"><a class="header" href="#关于参数传递">关于参数传递</a></h4>
<p>可以画一张参数传递的图，这样对wine的结构的了解能够更清晰。</p>
<div style="text-align:right; font-size:3em;">2019.9.3</div>
### 分析回顾总结Wine的启动过程
<p>因为一直没办法在GDB里跟踪到wine64被preloader动态加载之后的代码，所以还很难搞懂wine的具体启动方式。</p>
<p>今天配合这<code>ps -ejH</code>（详细看man ps）打印出process tree来看到很有趣的过程，用http://asciiflow.com/绘制，<strong>注1</strong>：相同pid的程序在同一行，<strong>注2</strong>：图中有两个同名的进程wineserver用数字1、2做了区别，从GDB来看2是1fork出来的，</p>
<pre><code>     Time+-----&gt;     Wine process tree
   +-------------------------------+----------------------+----------------+
pid|          |                    |                      |                |
 + | gdb      | gdb                | gdb                  | gdb            |
 | |   wine64 |   wine64-preloader |   wine64             |   coremark     |
 | |          |                    |     wineserver(1)    |                |
 v |          |                    |                      | wineserver(2)  |
   |          |                    |                      | services.exe   |
   |          |                    |                      | plugplay.exe   |
   |          |                    |                      | winedevice.exe |
   |          |                    |                      |                |
   +----------+--------------------+----------------------+----------------+

</code></pre>
<p>很有必要搞清这一切，希望能用GDB跟踪wine64被preloader动态加载之后的代码！遂想用DGB从汇编上来跟踪试试。</p>
<p>用GDB的<code>ni</code>命令，从<code>loader/preloader.c: wld_start</code>开始跟踪。跟到了调用<code>/lib64/ld-linux-x86-64.so.2</code>这里。用GDB看了栈内的情况（用<code>x/a $rsp</code>然后<code>x/s ADDRESS</code>的方式看，<strong>不知道为什么<code>x/s *$rsp</code>会出错</strong>），感觉全是系统的环境变量。于是想去看看<code>/lib64/ld-linux-x86-64.so.2</code>的源码。搜索关键词ld.so的源码，找到了在binutils里。于是根据GNU官网的提示，</p>
<pre><code class="language-bash"># 太多东西了，没有去看，我觉得问题不在这里
# https://www.gnu.org/software/binutils/
git clone git://sourceware.org/git/binutils-gdb.git
</code></pre>
<p>在网上看到了编译时加<code>-g3</code>选项，调试信息更多，（变慢了，也没啥用）</p>
<pre><code class="language-bash">./configure --enable-win64 CFLAGS=&quot;-g3 -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=0&quot;
</code></pre>
<p>疑惑，interpreter是干嘛的？答：是动态链接器（dynamic linker）的路径，<a href="https://en.wikipedia.org/wiki/Dynamic_linker">wikipedia Dynamic linker</a>给出了简单的说明。</p>
<p>在<code>loader/preloader.c</code>里有看到“auxiliary values”，<a href="http://articles.manugarg.com/aboutelfauxiliaryvectors">什么是ELF Auxiliary Vectors</a>有解释，说不定对解决问题有帮助。总的说来，是可执行文件的加载器（内核）把各种用户程序需要的参数（argv, argc, env等）装到用户栈里去。关于<code>loader/preloader.c: 1255 wld_start(void **stack)</code>的参数哪来的，查阅汇编的第6次ppt找到了84页&quot;x86 linux abi&quot;的关键字，于是上网去搜索，找到<a href="https://en.wikipedia.org/wiki/X86_calling_conventions">wikipedia的x86 calling conventions</a>。所以可知x86-64遵循System V AMD64 ABI把前6个函数参数放在RDI, RSI, RDX, RCX, R8, R9寄存器里。所以参数<code>void **stack</code>来源于365行<code>movq %rsp,%rdi</code>。</p>
<p>有趣的是在这些代码上边有关于thread的代码，</p>
<pre><code class="language-assembly">movq $thread_data,%rsi
movq $0x1002,%rdi    /* ARCH_SET_FS */
movq $158,%rax       /* SYS_arch_prctl */
syscall
</code></pre>
<p><del>所以真的是thread的原因吗？</del></p>
<p>用gdb break到wine64 main函数的开始地址，成功的停下来了！地址来源于<code>wld_start</code>的<code>main_binary_map.l_entry</code>。当时担心这个地址会被动态加载器重定位，所以跑去看了<code>wld_start</code>搜索<code>wine_main_preload_info</code>的地址，就在附近，所以才放心的break到这个地址的，且经过多次试验，这些地址都是不变的，且和wine64文件通过readelf看到的地址保持一致的，具体操作如下</p>
<pre><code class="language-bash"># 现在停在了wld_start函数里，/x表示输出格式为16进制
(gdb) p/x main_binary_map.l_entry
0x7c000b30
(gdb) b *0x7c000b30
(gdb) c # 然后成功停在了0x7c000b30这个位置！
# 但是没有源码对应，在完全想到办法前，用objdump辅助一下
# 在另外一个终端里，-S表示反汇编且交织（intermixed）源代码（隐含了-d，-d仅仅只会反汇编，显示源码），
objdump -S ./wine64
</code></pre>
<p>由此看来不是thread的原因，所以上面错误的猜测被我差掉了。</p>
<p><span style="font-size:2em;">🤔</span>猜测是Wine的工程师自己写了动态调用的方法，没有把debug信息给加载进去。<span style="color:red; font-weight:bold">如果真的是这样的话，是不是configure的时候有什么设置可以让debug信息被加载进去呢？或者动态有办法把debug信息手动添加到GDB里吗？</span></p>
<p><strong>注1</strong>：我把我用objdump出来的文件都以后缀名<code>.objdump.txt</code>存到了文件的同一路径下（用<code>&gt;</code>重定向结果），<strong>注2</strong>：<span style="color:blue; font-weight:bold">R</span>表示代码被重定位了（reallocate），<span style="color:green; font-weight:bold">S</span>表示代码地址没有变没有被重定位（stay），<strong>注3</strong>：圆括号里是ELF文件里的地址（即被重定位前的地址），方括号里是调用地址（<code>wine_init</code>像是跳转表表项的地址，我在GDB里看到附近很多jmp指令，感觉是跳转表，仔细一想这很符合动态加载的特性），<strong>注4</strong>：下面的宽的空隙用的是tab键，</p>
<ul>
<li><code>loader/wine64</code> from <code>loader/main.c</code>
<ul>
<li><span style="color:green; font-weight:bold">S</span>	<code>_start</code>	@0x7c000b30</li>
</ul>
</li>
</ul>
<div style="text-align:right; font-size:3em;">2019.9.4</div>
* `libs/wine/libwine.so.1.0` from `libs/wine/loader.c`
  * <span style="color:blue; font-weight:bold">R</span>	`wine_init`	@0x7ffff7a2e3cd	(@0x93cd)	[@0x7c000ae0]
* `dlls/ntdll/ntdll.dll.so` from `dlls/ntdll/loader.c`
  * <span style="color:green; font-weight:bold">S</span>	`__wine_process_init`	@0x7bc851e9	[@0x7ffff7a2e51f]
    * `thread_init()`~~后没有看到新的进程和线程出现，就很奇怪，明明这里有fork出一个server进程，wineserver已经独立了？没仔细看。~~先fork了wineserver，然后在wineserver的main里再次fork了一个（非wine64的子进程），并让当前这个wineserver（新wineserver的父进程，wine64的子进程）退出了。
* `dlls/kernel32/kernel32.dll.so` form `dlls/kernel32/process.c`
  * <span style="color:green; font-weight:bold">S</span>	`__wine_kernel_init`	@0x7b493925	[@0x7bc8532f]
    * 在这里某一处进程名字已经变成coremark了，对，1407调用了set_process_name，
  * <span style="color:green; font-weight:bold">S</span>	`server_init_process_done`	@0x7bcc7774	[@7bc857bf]
  * <span style="color:green; font-weight:bold">S</span>	`signal_start_process`	@0x7bcd5467	[@7bcc7902]
  * <span style="color:green; font-weight:bold">S</span>	`start_process`（`kernel32_start_process`指向的是这个函数）	@0x7b49348d	
  * <span style="color:green; font-weight:bold">S</span>	`call_process_entry`	@0x7b493466
<h2 id="内存分布"><a class="header" href="#内存分布">内存分布</a></h2>
<h3 id="生成预留地址表"><a class="header" href="#生成预留地址表">生成预留地址表</a></h3>
<p>使用<code>wld_start: 1294</code>，定义112</p>
<pre><code class="language-c">static struct wine_preload_info preload_info[] =
{
#ifdef __i386__
    { (void *)0x00000000, 0x00010000 },  /* low 64k */
    { (void *)0x00010000, 0x00100000 },  /* DOS area */
    { (void *)0x00110000, 0x67ef0000 },  /* low memory area */
    { (void *)0x7f000000, 0x03000000 },  /* top-down allocations + shared heap + virtual heap */
#else
    { (void *)0x000000010000, 0x00100000 },  /* DOS area */
    { (void *)0x000000110000, 0x67ef0000 },  /* low memory area */
    { (void *)0x00007ff00000, 0x000f0000 },  /* shared user data */
    { (void *)0x7ffffe000000, 0x01ff0000 },  /* top-down allocations + virtual heap */
#endif
    { 0, 0 },                            /* PE exe range set with WINEPRELOADRESERVE */
    { 0, 0 }                             /* end of list */
};
</code></pre>
<p>1320：一定要把最顶上的1页留出来。</p>
<h4 id="wine64的内存分布"><a class="header" href="#wine64的内存分布">Wine64的内存分布</a></h4>
<pre><code class="language-c">main_binary_map = 
{l_addr = 0, l_ld = 0x7c002d40, l_phdr = 0x7c000040, 
  l_entry = 2080377648, l_ldnum = 68, l_phnum = 9, l_map_start = 2080374784, 
  l_map_end = 2080387160, l_interp = 2080375352}
</code></pre>
<h3 id="wine64的interpreter的内存分布ldso"><a class="header" href="#wine64的interpreter的内存分布ldso">Wine64的Interpreter的内存分布（ld.so）</a></h3>
<pre><code class="language-c">{l_addr = 140737351847936, l_ld = 0x227e68, l_phdr = 0x7ffff7dd1040, 
  l_entry = 140737351852176, l_ldnum = 46, l_phnum = 7, 
  l_map_start = 140737351847936, l_map_end = 140737354113392, l_interp = 0}
</code></pre>
<p>完成内存预留是在wine64的main的225的<code>wine_mmap_add_reserved_area</code>函数。此刻的内存分布，</p>
<pre><code>pmap 进程号

0000000000010000 1703872K -----   [ anon ]
000000007c000000      8K r-x-- wine64
000000007c002000      4K r---- wine64
000000007c003000      4K rw--- wine64
000000007c400000     12K r-x-- wine64-preloader
000000007c603000      4K rw--- wine64-preloader
000000007c604000    132K rw---   [ anon ]
000000007ff00000    960K -----   [ anon ]
00007ffff71ee000      8K rw---   [ anon ]
00007ffff71f0000     12K r-x-- libdl-2.27.so
00007ffff71f3000   2044K ----- libdl-2.27.so
00007ffff73f2000      4K r---- libdl-2.27.so
00007ffff73f3000      4K rw--- libdl-2.27.so
00007ffff73f4000   1948K r-x-- libc-2.27.so
00007ffff75db000   2048K ----- libc-2.27.so
00007ffff77db000     16K r---- libc-2.27.so
00007ffff77df000      8K rw--- libc-2.27.so
00007ffff77e1000     16K rw---   [ anon ]
00007ffff77e5000    104K r-x-- libpthread-2.27.so
00007ffff77ff000   2044K ----- libpthread-2.27.so
00007ffff79fe000      4K r---- libpthread-2.27.so
00007ffff79ff000      4K rw--- libpthread-2.27.so
00007ffff7a00000     16K rw---   [ anon ]
00007ffff7a25000   1688K r-x-- libwine.so.1.0
00007ffff7bcb000   2048K ----- libwine.so.1.0
00007ffff7dcb000      8K r---- libwine.so.1.0
00007ffff7dcd000      4K rw--- libwine.so.1.0
00007ffff7dce000     12K rw---   [ anon ]
00007ffff7dd1000    156K r-x-- ld-2.27.so
00007ffff7df8000   1892K ----- ld-2.27.so
00007ffff7fd1000    156K rw--- ld-2.27.so
00007ffff7ff8000      4K r---- ld-2.27.so
00007ffff7ff9000      4K rw--- ld-2.27.so
00007ffff7ffa000      4K rw---   [ anon ]
00007ffff7ffb000     12K r----   [ anon ]
00007ffff7ffe000      4K r-x--   [ anon ]
00007ffffe000000  32704K -----   [ anon ]
00007fffffff0000     60K rw---   [ stack ]
ffffffffff600000      4K r-x--   [ anon ]
 total          1752036K

</code></pre>
<p><code>wine_init: 974</code>加载完成ntdll.dll后的内存新增（在各个可能的路径里去找），<strong>注</strong>：用https://text-compare.com/比较，</p>
<pre><code>...
000000007bc00000   1396K r-x-- ntdll.dll.so
000000007bd5d000      4K ----- ntdll.dll.so
000000007bd5e000      4K r---- ntdll.dll.so
000000007bd5f000     52K rw--- ntdll.dll.so
000000007bd6c000     80K rw---   [ anon ]
...
00007ffff6c38000     92K r-x-- libgcc_s.so.1
00007ffff6c4f000   2044K ----- libgcc_s.so.1
00007ffff6e4e000      4K r---- libgcc_s.so.1
00007ffff6e4f000      4K rw--- libgcc_s.so.1
00007ffff6e50000   1652K r-x-- libm-2.27.so
00007ffff6fed000   2044K ----- libm-2.27.so
00007ffff71ec000      4K r---- libm-2.27.so
00007ffff71ed000      4K rw--- libm-2.27.so
...
total          1759420K
</code></pre>
<p>在刚刚执行到<code>__wine_kernel32_init</code>时的内存增量，</p>
<pre><code>0000000000010000     64K rw---   [ anon ]
0000000000020000   1024K -----   [ anon ]
0000000000120000      4K rw---   [ anon ]
0000000000121000      4K -----   [ anon ]
0000000000122000 1702776K -----   [ anon ]
0000000071040000      4K r---- kernelbase.dll
0000000071041000    256K r-x--   [ anon ]
0000000071081000     12K rw---   [ anon ]
0000000071084000     72K r----   [ anon ]
0000000071096000      4K rw---   [ anon ]
0000000071097000    120K r----   [ anon ]
00000000710b5000     16K rw--- kernelbase.dll
00000000710b9000    540K r----   [ anon ]
0000000071140000     56K r---- kernelbase.dll
000000007114e000    564K r----   [ anon ]
000000007b400000    128K r-x-- kernel32.dll.so
000000007b420000      4K rw---   [ anon ]
000000007b421000   2540K r-x-- kernel32.dll.so
000000007b69c000     12K r---- kernel32.dll.so
000000007b69f000   1832K rw--- kernel32.dll.so
000000007b869000      4K rw---   [ anon ]
000000007bc00000    128K r-x-- ntdll.dll.so
000000007bc20000      4K rw---   [ anon ]
000000007bc21000   1264K r-x-- ntdll.dll.so
...
000000007ffe0000     64K rw---   [ anon ]
00007ffff61f6000     44K r-x-- libnss_files-2.27.so
00007ffff6201000   2044K ----- libnss_files-2.27.so
00007ffff6400000      4K r---- libnss_files-2.27.so
00007ffff6401000      4K rw--- libnss_files-2.27.so
00007ffff6402000     24K rw---   [ anon ]
00007ffff6408000     92K r-x-- libnsl-2.27.so
00007ffff641f000   2044K ----- libnsl-2.27.so
00007ffff661e000      4K r---- libnsl-2.27.so
00007ffff661f000      4K rw--- libnsl-2.27.so
00007ffff6620000      8K rw---   [ anon ]
00007ffff6622000     44K r-x-- libnss_nis-2.27.so
00007ffff662d000   2044K ----- libnss_nis-2.27.so
00007ffff682c000      4K r---- libnss_nis-2.27.so
00007ffff682d000      4K rw--- libnss_nis-2.27.so
00007ffff682e000     32K r-x-- libnss_compat-2.27.so
00007ffff6836000   2048K ----- libnss_compat-2.27.so
00007ffff6a36000      4K r---- libnss_compat-2.27.so
00007ffff6a37000      4K rw--- libnss_compat-2.27.so
00007ffff6a38000   2048K rw---   [ anon ]
...
00007fffffea8000     16K rw---   [ anon ]
00007fffffeac000     12K -----   [ anon ]
00007fffffeaf000   1284K rw---   [ anon ]
...
total          1776088K
</code></pre>
<p>刚运行完<code>__wine_kernel_init</code>后的内存增量，</p>
<pre><code>...
0000000000140000     12K rw---   [ anon ]
0000000000143000   2804K -----   [ anon ]
0000000000400000      4K r---- helloworld.exe
0000000000401000      8K r-x--   [ anon ]
0000000000403000      4K rw---   [ anon ]
0000000000404000     12K r----   [ anon ]
0000000000407000     16K rw---   [ anon ]
000000000040b000      4K r---- helloworld.exe
000000000040c000    304K r----   [ anon ]
0000000000458000     12K r---- helloworld.exe
000000000045b000     52K r----   [ anon ]
0000000000468000 1699424K -----   [ anon ]
...
00007ffff5827000  10044K r---- locale-archive
...
total          1786132K
</code></pre>
<p>将要运行完<code>__wine_process_init</code>时的内存增量，</p>
<pre><code>0000000000122000    120K -----   [ anon ]
0000000000140000     12K rw---   [ anon ]
0000000000143000   2804K -----   [ anon ]
# 总量没有变
</code></pre>
<p>执行到<code>signal_start_process</code>前面的时候内存分布没变化，<code>signal_start_process</code>的俩参数一个是entry是个是suspend（bool）分别是<code>0x401500</code>和<code>0</code>。我觉得suspend应该是表示进程状态的量。通过<code>objdump -S</code>（不知道这样查看windows的二进制文件是否是最好的方案，目前看来结果能看）看到helloworld的<code>0x401500</code>的标签（汇编里的那个标记位置的是叫标签吧？）是<code>&lt;mainCRTStartup&gt;</code>，看样子就是程序入口了！</p>
<p>在<code>start_thread</code>的<code>attach_thread</code>的<code>LdrInitializeThunk</code>完成加载用户程序需要的dll（注释：Attach to all the loaded dlls. If this is the first time, perform the full process initialization.）~~用户程序开始运行（在<code>&lt;mainCRTStartup&gt;</code>处）时~~的内存增量，</p>
<pre><code>...
0000000000468000     32K -----   [ anon ]
0000000000470000     64K rw---   [ anon ]
0000000000480000   1024K -----   [ anon ]
0000000000580000 1698304K -----   [ anon ]
...
00007ffff5724000    112K r-x-- msvcrt.dll.so
00007ffff5740000      4K rw---   [ anon ]
00007ffff5741000    868K r-x-- msvcrt.dll.so
00007ffff581a000      4K r---- msvcrt.dll.so
00007ffff581b000     40K rw--- msvcrt.dll.so
00007ffff5825000      8K rw---   [ anon ]
...
total          1787168K
</code></pre>
<h2 id="wine64执行流程"><a class="header" href="#wine64执行流程">Wine64执行流程</a></h2>
<p><img src="pictures/Wine64StartUp.svg" alt="Wine64StartUp" /></p>
<h2 id="专用术语"><a class="header" href="#专用术语">专用术语</a></h2>
<table><thead><tr><th>缩</th><th>全</th><th>首次出现</th></tr></thead><tbody>
<tr><td>TEB</td><td>Thread Environment Block</td><td><code>thread_init()</code>附近</td></tr>
<tr><td>PEB</td><td>Process Environment Block</td><td><code>thread_init()</code>里</td></tr>
<tr><td>FD</td><td>File Descriptor</td><td><code>server_init_process</code>里</td></tr>
</tbody></table>

                    </main>
                    <script src="https://utteranc.es/client.js"
                        repo="xieby1/xieby1.github.io"
                        issue-term="pathname"
                        theme="github-light"
                        crossorigin="anonymous"
                        async>
                    </script>
                </div>
            </div>
        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
        
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
